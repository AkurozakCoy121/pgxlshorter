<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PGXL.WEB.ID - Free Static Hosting</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .card {
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .file-item:hover {
            background: #f8f9fa;
            cursor: pointer;
        }
        .ads-footer {
            background: #f8f9fa;
            border-top: 3px solid #667eea;
            padding: 10px;
            text-align: center;
            font-size: 14px;
            color: #666;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-dark navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-server"></i> PGXL.WEB.ID
            </a>
            <div id="authButtons"></div>
        </div>
    </nav>

    <div class="container py-5">
        <!-- Welcome Section -->
        <div class="row mb-4" id="welcomeSection">
            <div class="col-12 text-center text-white">
                <h1 class="display-4 mb-3">üéØ Free Static Hosting</h1>
                <p class="lead">Host website HTML/CSS/JS mu dengan mudah!</p>
                <p>Dapatkan subdomain: <code>namaproject.pgxl.web.id</code></p>
                <button class="btn btn-light btn-lg mt-3" onclick="showAuthModal()">
                    <i class="fas fa-rocket"></i> Mulai Sekarang
                </button>
            </div>
        </div>

        <!-- Dashboard (Tampil setelah login) -->
        <div class="row d-none" id="dashboard">
            <!-- Sidebar -->
            <div class="col-md-3">
                <div class="card mb-4">
                    <div class="card-body">
                        <h5><i class="fas fa-user-circle"></i> <span id="userEmail"></span></h5>
                        <button class="btn btn-primary w-100 mb-2" onclick="showAddProjectModal()">
                            <i class="fas fa-plus"></i> Add Website
                        </button>
                        <button class="btn btn-outline-danger w-100" onclick="logout()">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>

                <!-- Project List -->
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-globe"></i> Website Saya
                    </div>
                    <div class="card-body p-0">
                        <ul class="list-group list-group-flush" id="projectList">
                            <!-- Project list akan diisi JavaScript -->
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="col-md-9">
                <!-- File Manager -->
                <div class="card mb-4 d-none" id="fileManager">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <div>
                            <i class="fas fa-folder"></i> 
                            <span id="currentProjectName"></span>
                            <small class="text-muted" id="currentProjectUrl"></small>
                        </div>
                        <div>
                            <button class="btn btn-sm btn-success" onclick="showAddFileModal()">
                                <i class="fas fa-plus"></i> File Baru
                            </button>
                            <button class="btn btn-sm btn-primary" onclick="showUploadModal()">
                                <i class="fas fa-upload"></i> Upload
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <!-- Breadcrumb -->
                        <nav aria-label="breadcrumb">
                            <ol class="breadcrumb" id="breadcrumb">
                                <li class="breadcrumb-item active">/</li>
                            </ol>
                        </nav>

                        <!-- Files Table -->
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th width="50px"></th>
                                        <th>Nama</th>
                                        <th>Ukuran</th>
                                        <th>Terakhir diubah</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="filesTable">
                                    <!-- Files akan diisi JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Editor -->
                <div class="card d-none" id="editorSection">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span id="editorFileName"></span>
                        <div>
                            <button class="btn btn-sm btn-success" onclick="saveFile()">
                                <i class="fas fa-save"></i> Simpan
                            </button>
                            <button class="btn btn-sm btn-secondary" onclick="closeEditor()">
                                <i class="fas fa-times"></i> Tutup
                            </button>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        <div id="codeEditor" style="height: 500px;"></div>
                    </div>
                </div>

                <!-- Welcome to Dashboard -->
                <div class="card" id="welcomeDashboard">
                    <div class="card-body text-center py-5">
                        <i class="fas fa-cloud-upload-alt fa-4x text-muted mb-3"></i>
                        <h3>Selamat Datang di PGXL.WEB.ID</h3>
                        <p class="text-muted">Pilih website dari sidebar atau buat website baru</p>
                        <p>üìÅ Upload file HTML, CSS, JS, gambar, dll</p>
                        <p>üåê Dapatkan subdomain gratis</p>
                        <p>‚ö° Auto deploy dalam hitungan detik</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Info Section -->
        <div class="row mt-5">
            <div class="col-md-4 mb-3">
                <div class="card h-100">
                    <div class="card-body text-center">
                        <i class="fas fa-bolt fa-3x text-primary mb-3"></i>
                        <h5>‚ö° Cepat & Mudah</h5>
                        <p>Upload file, langsung online. Tidak perlu config ribet.</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card h-100">
                    <div class="card-body text-center">
                        <i class="fas fa-tag fa-3x text-success mb-3"></i>
                        <h5>üí∞ 100% Gratis</h5>
                        <p>Tidak ada biaya hosting. Selamanya gratis untuk website statis.</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-3">
                <div class="card h-100">
                    <div class="card-body text-center">
                        <i class="fas fa-code fa-3x text-warning mb-3"></i>
                        <h5>üîß File Manager</h5>
                        <p>Edit file langsung di browser. Support HTML, CSS, JavaScript.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer with Ads -->
    <footer class="ads-footer mt-5">
        <div class="container">
            <p>
                <strong>Powered by PGXL.WEB.ID</strong> | 
                Free Static Hosting for Indonesia | 
                <a href="#" class="text-decoration-none">Terms</a> | 
                <a href="#" class="text-decoration-none">Privacy</a>
            </p>
            <p class="mb-0">
                ¬© 2025 PGXL.WEB.ID - Hosting website statis gratis dengan subdomain custom.
            </p>
        </div>
    </footer>

    <!-- Modals -->
    <div class="modal fade" id="authModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Login / Daftar</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center">
                    <button class="btn btn-outline-dark w-100 mb-2" onclick="signInWithGoogle()">
                        <i class="fab fa-google"></i> Lanjut dengan Google
                    </button>
                    <button class="btn btn-outline-primary w-100" onclick="signInWithFacebook()">
                        <i class="fab fa-facebook"></i> Lanjut dengan Facebook
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Project Modal -->
    <div class="modal fade" id="addProjectModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">‚ûï Add Website Baru</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Nama Project</label>
                        <input type="text" class="form-control" id="projectName" placeholder="my-portfolio">
                        <div class="form-text">Akan menjadi: <span id="domainPreview">...</span></div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Deskripsi</label>
                        <textarea class="form-control" id="projectDescription" rows="3" placeholder="Website portfolio saya..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-primary" onclick="createProject()">Buat Website</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-storage-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.js"></script>
    
    <script>
        // Firebase Config (akan diganti dengan file terpisah)
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "pgxl-web-id.firebaseapp.com",
            projectId: "pgxl-web-id",
            storageBucket: "pgxl-web-id.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();

        // Global variables
        let currentUser = null;
        let currentProject = null;
        let currentPath = '/';
        let editor = null;

        // DOM Ready
        document.addEventListener('DOMContentLoaded', function() {
            // Auth State Listener
            auth.onAuthStateChanged((user) => {
                if (user) {
                    currentUser = user;
                    showDashboard();
                } else {
                    showWelcome();
                }
            });

            // Init domain preview
            document.getElementById('projectName').addEventListener('input', updateDomainPreview);
        });

        // Functions
        function showWelcome() {
            document.getElementById('welcomeSection').classList.remove('d-none');
            document.getElementById('dashboard').classList.add('d-none');
            document.getElementById('authButtons').innerHTML = `
                <button class="btn btn-outline-light" onclick="showAuthModal()">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
            `;
        }

        function showDashboard() {
            document.getElementById('welcomeSection').classList.add('d-none');
            document.getElementById('dashboard').classList.remove('d-none');
            document.getElementById('userEmail').textContent = currentUser.email;
            document.getElementById('authButtons').innerHTML = `
                <span class="text-white me-3">${currentUser.email}</span>
                <button class="btn btn-outline-light" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            `;
            loadProjects();
        }

        function showAuthModal() {
            new bootstrap.Modal(document.getElementById('authModal')).show();
        }

        function showAddProjectModal() {
            document.getElementById('projectName').value = '';
            document.getElementById('projectDescription').value = '';
            updateDomainPreview();
            new bootstrap.Modal(document.getElementById('addProjectModal')).show();
        }

        function updateDomainPreview() {
            const name = document.getElementById('projectName').value.toLowerCase()
                .replace(/[^a-z0-9-]/g, '-')
                .replace(/-+/g, '-')
                .replace(/^-|-$/g, '') || 'myproject';
            document.getElementById('domainPreview').textContent = `${name}.pgxl.web.id`;
        }

        async function createProject() {
            const name = document.getElementById('projectName').value;
            const description = document.getElementById('projectDescription').value;
            
            if (!name) {
                alert('Nama project harus diisi!');
                return;
            }

            const projectId = name.toLowerCase()
                .replace(/[^a-z0-9-]/g, '-')
                .replace(/-+/g, '-')
                .replace(/^-|-$/g, '');
            
            const projectData = {
                name: name,
                description: description,
                domain: `${projectId}.pgxl.web.id`,
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                owner: currentUser.uid,
                files: []
            };

            try {
                await db.collection('projects').doc(projectId).set(projectData);
                
                // Create default index.html with ads
                const defaultHTML = `<!DOCTYPE html>
<html>
<head>
    <title>${name}</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .pgxl-ads { background: #f8f9fa; border: 2px solid #667eea; padding: 15px; text-align: center; margin: 30px 0; border-radius: 10px; }
    </style>
</head>
<body>
    <h1>Welcome to ${name}</h1>
    <p>Your website is hosted on PGXL.WEB.ID</p>
    
    <div class="pgxl-ads">
        <h3>üöÄ Powered by PGXL.WEB.ID</h3>
        <p>Free static hosting with custom subdomain</p>
        <a href="https://pgxl.web.id" target="_blank">Create your own free website</a>
    </div>
    
    <p>Edit this file in your dashboard to customize your website.</p>
</body>
</html>`;

                await storage.ref(`projects/${projectId}/index.html`).putString(defaultHTML, 'raw');
                
                bootstrap.Modal.getInstance(document.getElementById('addProjectModal')).hide();
                alert('Website berhasil dibuat!');
                loadProjects();
            } catch (error) {
                console.error('Error creating project:', error);
                alert('Gagal membuat website: ' + error.message);
            }
        }

        async function loadProjects() {
            try {
                const snapshot = await db.collection('projects')
                    .where('owner', '==', currentUser.uid)
                    .get();
                
                const projectList = document.getElementById('projectList');
                projectList.innerHTML = '';
                
                snapshot.forEach(doc => {
                    const project = doc.data();
                    const li = document.createElement('li');
                    li.className = 'list-group-item list-group-item-action';
                    li.innerHTML = `
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <strong>${project.name}</strong><br>
                                <small class="text-muted">${project.domain}</small>
                            </div>
                            <button class="btn btn-sm btn-outline-primary" onclick="openProject('${doc.id}')">
                                <i class="fas fa-folder-open"></i>
                            </button>
                        </div>
                    `;
                    projectList.appendChild(li);
                });
            } catch (error) {
                console.error('Error loading projects:', error);
            }
        }

        function openProject(projectId) {
            currentProject = projectId;
            document.getElementById('welcomeDashboard').classList.add('d-none');
            document.getElementById('fileManager').classList.remove('d-none');
            document.getElementById('editorSection').classList.add('d-none');
            
            db.collection('projects').doc(projectId).get().then(doc => {
                const project = doc.data();
                document.getElementById('currentProjectName').textContent = project.name;
                document.getElementById('currentProjectUrl').innerHTML = 
                    `<a href="https://${project.domain}" target="_blank">${project.domain}</a>`;
            });
            
            loadFiles('/');
        }

        async function loadFiles(path) {
            currentPath = path;
            
            // Update breadcrumb
            const breadcrumb = document.getElementById('breadcrumb');
            breadcrumb.innerHTML = '<li class="breadcrumb-item active">/</li>';
            
            const filesTable = document.getElementById('filesTable');
            filesTable.innerHTML = '<tr><td colspan="5" class="text-center">Loading...</td></tr>';
            
            try {
                const listRef = storage.ref(`projects/${currentProject}${path}`);
                const result = await listRef.listAll();
                
                filesTable.innerHTML = '';
                
                // Directories first
                result.prefixes.forEach(folderRef => {
                    const name = folderRef.name;
                    const tr = document.createElement('tr');
                    tr.className = 'file-item';
                    tr.innerHTML = `
                        <td><i class="fas fa-folder text-warning"></i></td>
                        <td><strong>${name}</strong></td>
                        <td>-</td>
                        <td>-</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary" onclick="openFolder('${name}')">
                                <i class="fas fa-folder-open"></i>
                            </button>
                        </td>
                    `;
                    filesTable.appendChild(tr);
                });
                
                // Files
                for (const itemRef of result.items) {
                    const metadata = await itemRef.getMetadata();
                    const name = itemRef.name;
                    const size = formatBytes(metadata.size);
                    const updated = new Date(metadata.updated).toLocaleString();
                    
                    const tr = document.createElement('tr');
                    tr.className = 'file-item';
                    tr.innerHTML = `
                        <td><i class="fas fa-file text-primary"></i></td>
                        <td>${name}</td>
                        <td>${size}</td>
                        <td>${updated}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-success" onclick="editFile('${name}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteFile('${name}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    filesTable.appendChild(tr);
                }
                
                if (result.prefixes.length === 0 && result.items.length === 0) {
                    filesTable.innerHTML = '<tr><td colspan="5" class="text-center">Folder kosong</td></tr>';
                }
            } catch (error) {
                console.error('Error loading files:', error);
                filesTable.innerHTML = '<tr><td colspan="5" class="text-center text-danger">Error loading files</td></tr>';
            }
        }

        function openFolder(folderName) {
            loadFiles(currentPath + folderName + '/');
        }

        async function editFile(fileName) {
            try {
                const fileRef = storage.ref(`projects/${currentProject}${currentPath}${fileName}`);
                const url = await fileRef.getDownloadURL();
                const response = await fetch(url);
                const content = await response.text();
                
                document.getElementById('fileManager').classList.add('d-none');
                document.getElementById('editorSection').classList.remove('d-none');
                document.getElementById('editorFileName').textContent = fileName;
                
                if (!editor) {
                    editor = ace.edit("codeEditor");
                    editor.setTheme("ace/theme/monokai");
                    editor.session.setMode("ace/mode/html");
                }
                
                editor.setValue(content, -1);
                editor.session.setMode(getEditorMode(fileName));
            } catch (error) {
                console.error('Error editing file:', error);
                alert('Gagal membuka file: ' + error.message);
            }
        }

        function getEditorMode(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            const modes = {
                'html': 'ace/mode/html',
                'css': 'ace/mode/css',
                'js': 'ace/mode/javascript',
                'json': 'ace/mode/json',
                'txt': 'ace/mode/text'
            };
            return modes[ext] || 'ace/mode/text';
        }

        async function saveFile() {
            const fileName = document.getElementById('editorFileName').textContent;
            const content = editor.getValue();
            
            try {
                const fileRef = storage.ref(`projects/${currentProject}${currentPath}${fileName}`);
                await fileRef.putString(content, 'raw');
                alert('File berhasil disimpan!');
                loadFiles(currentPath);
            } catch (error) {
                console.error('Error saving file:', error);
                alert('Gagal menyimpan file: ' + error.message);
            }
        }

        function closeEditor() {
            document.getElementById('editorSection').classList.add('d-none');
            document.getElementById('fileManager').classList.remove('d-none');
        }

        function showAddFileModal() {
            const name = prompt('Nama file (contoh: style.css):');
            if (name) {
                const defaultContent = name.endsWith('.html') ? 
                    `<!DOCTYPE html>
<html>
<head>
    <title>New Page</title>
</head>
<body>
    <h1>New Page</h1>
    <div class="pgxl-ads">
        <p>Hosted on PGXL.WEB.ID</p>
    </div>
</body>
</html>` : '';
                
                const fileRef = storage.ref(`projects/${currentProject}${currentPath}${name}`);
                fileRef.putString(defaultContent, 'raw').then(() => {
                    loadFiles(currentPath);
                });
            }
        }

        function showUploadModal() {
            const input = document.createElement('input');
            input.type = 'file';
            input.multiple = true;
            input.onchange = async (e) => {
                const files = e.target.files;
                for (let file of files) {
                    const fileRef = storage.ref(`projects/${currentProject}${currentPath}${file.name}`);
                    await fileRef.put(file);
                }
                loadFiles(currentPath);
            };
            input.click();
        }

        async function deleteFile(fileName) {
            if (confirm(`Hapus file ${fileName}?`)) {
                try {
                    const fileRef = storage.ref(`projects/${currentProject}${currentPath}${fileName}`);
                    await fileRef.delete();
                    loadFiles(currentPath);
                } catch (error) {
                    console.error('Error deleting file:', error);
                    alert('Gagal menghapus file');
                }
            }
        }

        function formatBytes(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Auth Functions
        function signInWithGoogle() {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider);
        }

        function signInWithFacebook() {
            const provider = new firebase.auth.FacebookAuthProvider();
            auth.signInWithPopup(provider);
        }

        function logout() {
            auth.signOut();
        }
    </script>
</body>
</html>
