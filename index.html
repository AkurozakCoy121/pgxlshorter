<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PGXL.WEB.ID - Free Static Hosting</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://widget.cloudinary.com/v2.0/global/all.js" type="text/javascript"></script>
    <style>
        :root {
            --primary: #667eea;
            --secondary: #764ba2;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --light: #f8fafc;
            --dark: #1e293b;
        }
        
        body {
            background: #ffffff;
            color: #333;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }
        
        .card {
            border: 1px solid #eaeaea;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.1);
        }
        
        .navbar {
            background: #fff;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border-bottom: 1px solid #eaeaea;
        }
        
        .btn-primary {
            background: var(--primary);
            border: none;
            border-radius: 8px;
            padding: 10px 24px;
            font-weight: 500;
        }
        
        .btn-primary:hover {
            background: #5a67d8;
        }
        
        .btn-success {
            background: var(--success);
            border: none;
            border-radius: 8px;
            padding: 10px 24px;
            font-weight: 500;
        }
        
        .btn-danger {
            background: var(--danger);
            border: none;
            border-radius: 8px;
            padding: 10px 24px;
            font-weight: 500;
        }
        
        .file-item:hover {
            background: var(--light);
        }
        
        .footer {
            background: var(--light);
            border-top: 1px solid #eaeaea;
            padding: 40px 0;
            margin-top: 60px;
            color: #64748b;
        }
        
        .feature-icon {
            width: 48px;
            height: 48px;
            background: var(--primary);
            color: white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 20px;
        }
        
        .project-domain {
            font-family: 'Courier New', monospace;
            background: #f1f5f9;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
        }
        
        #codeEditor {
            height: 500px;
            width: 100%;
            border-radius: 8px;
            border: 1px solid #eaeaea;
        }
        
        .ace_editor {
            font-size: 14px !important;
            border-radius: 8px !important;
        }
        
        .limit-badge {
            background: var(--warning);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8em;
            margin-left: 10px;
        }
        
        #projectViewerContainer {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            z-index: 999999;
        }
        
        .pgxl-banner {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 10px 20px;
            text-align: center;
            font-size: 14px;
            z-index: 10000;
        }
        
        .upload-progress {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            padding: 20px;
            z-index: 10000;
            max-width: 300px;
        }
        
        .progress-bar {
            height: 8px;
            border-radius: 4px;
            background: var(--primary);
            transition: width 0.3s ease;
        }
        
        .live-preview {
            border: 2px solid var(--primary);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .stats-card {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border-radius: 12px;
            padding: 20px;
        }
        
        .changelog-item {
            border-left: 4px solid var(--primary);
            padding-left: 15px;
            margin-bottom: 20px;
        }
        
        .changelog-badge {
            background: var(--primary);
            color: white;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.7em;
            margin-right: 10px;
        }
        
        .file-explorer {
            background: var(--light);
            border-radius: 10px;
            padding: 15px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .file-item {
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .file-item:hover {
            background: white;
            transform: translateX(5px);
        }
        
        .file-icon {
            width: 40px;
            height: 40px;
            background: var(--light);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
        }
        
        .not-found {
            text-align: center;
            padding: 100px 20px;
        }
        
        .not-found-icon {
            font-size: 80px;
            color: var(--danger);
            margin-bottom: 20px;
        }
        
        .refresh-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            z-index: 1000;
        }
        
        /* Cloudinary Upload Styles */
        .cloudinary-upload-btn {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 16px;
            cursor: pointer;
        }
        
        .file-actions {
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .file-item:hover .file-actions {
            opacity: 1;
        }
        
        /* Domain Suggestions */
        .domain-suggestion-badge {
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .domain-suggestion-badge:hover {
            transform: scale(1.05);
        }
        
        /* File Icons */
        .fa-file-image { color: #10b981; }
        .fa-file-pdf { color: #ef4444; }
        .fa-file-archive { color: #f59e0b; }
        .fa-file-code { color: #3b82f6; }
        .fa-file-alt { color: #6b7280; }
        
        .breadcrumb {
            background: transparent;
            padding: 0;
            margin-bottom: 15px;
        }
        
        .breadcrumb-item.active {
            color: var(--primary);
        }
        
        .current-path {
            font-family: monospace;
            background: #f1f5f9;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            margin-left: 10px;
        }
        
        .cloudinary-badge {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            font-size: 10px;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: 5px;
        }
    </style>
</head>
<body>
    <!-- Project Viewer (Hidden by default) -->
    <div id="projectViewerContainer">
        <div id="projectViewer"></div>
    </div>

    <!-- Upload Progress (Hidden by default) -->
    <div id="uploadProgress" class="upload-progress d-none">
        <h6><i class="fas fa-upload me-2"></i>Uploading...</h6>
        <div class="mb-2">
            <small id="uploadFileName"></small>
            <small id="uploadPercent" class="float-end">0%</small>
        </div>
        <div class="progress" style="height: 6px;">
            <div id="uploadProgressBar" class="progress-bar" style="width: 0%"></div>
        </div>
        <small id="uploadStatus" class="text-muted">Preparing...</small>
    </div>

    <!-- Refresh Button -->
    <button class="refresh-btn d-none" id="refreshBtn" onclick="refreshPage()">
        <i class="fas fa-sync-alt"></i>
    </button>

    <!-- Main App Content -->
    <div id="mainAppContent">
        <!-- Navbar -->
        <nav class="navbar navbar-expand-lg navbar-light">
            <div class="container">
                <a class="navbar-brand fw-bold text-primary" href="#">
                    <i class="fas fa-server me-2"></i>PGXL.WEB.ID
                    <span class="badge bg-success ms-2">v2.1</span>
                    <small class="cloudinary-badge">+ Cloudinary</small>
                </a>
                <div id="authButtons"></div>
            </div>
        </nav>

        <div class="container py-5">
            <!-- Welcome Section -->
            <div class="row mb-5" id="welcomeSection">
                <div class="col-12 text-center">
                    <h1 class="display-5 fw-bold mb-3">üöÄ Hosting Website Statis 100% Gratis</h1>
                    <p class="lead text-muted mb-4">Upload file HTML/CSS/JS dan dapatkan subdomain instan</p>
                    
                    <div class="project-domain d-inline-block mb-4">
                        namaproject<span class="text-primary">.pgxl.web.id</span>
                    </div>
                    
                    <div class="d-flex gap-3 justify-content-center">
                        <button class="btn btn-primary btn-lg" onclick="showAuthModal()">
                            <i class="fas fa-rocket me-2"></i>Mulai Gratis
                        </button>
                        <a href="#changelog" class="btn btn-outline-secondary btn-lg">
                            <i class="fas fa-history me-2"></i>Changelog
                        </a>
                    </div>
                    
                    <!-- Limits Info -->
                    <div class="mt-5">
                        <div class="row justify-content-center">
                            <div class="col-md-8">
                                <div class="card border-success">
                                    <div class="card-body text-center">
                                        <h5 class="card-title text-success">
                                            <i class="fas fa-gift me-2"></i>Free Plan - No Limits!
                                        </h5>
                                        <div class="row mt-3">
                                            <div class="col-md-4 mb-3">
                                                <i class="fas fa-globe text-primary fa-2x mb-2"></i>
                                                <h6>5 Website</h6>
                                                <small class="text-muted">Per akun</small>
                                            </div>
                                            <div class="col-md-4 mb-3">
                                                <i class="fas fa-file-upload text-primary fa-2x mb-2"></i>
                                                <h6>20MB/file</h6>
                                                <small class="text-muted">Max upload size</small>
                                            </div>
                                            <div class="col-md-4 mb-3">
                                                <i class="fas fa-infinity text-primary fa-2x mb-2"></i>
                                                <h6>Unlimited Traffic</h6>
                                                <small class="text-muted">No ads, 100% free</small>
                                            </div>
                                        </div>
                                        <div class="alert alert-success mt-3">
                                            <i class="fas fa-check-circle me-2"></i>
                                            <strong>NO ADS!</strong> Tidak ada iklan sama sekali dari PGXL
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Features -->
            <div class="row mb-5" id="features">
                <div class="col-md-3 mb-4">
                    <div class="card h-100 border-0">
                        <div class="card-body text-center p-4">
                            <div class="feature-icon">
                                <i class="fas fa-bolt"></i>
                            </div>
                            <h5 class="fw-bold">Deploy Instan</h5>
                            <p class="text-muted">Upload file, langsung online. Tidak perlu config ribet.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-4">
                    <div class="card h-100 border-0">
                        <div class="card-body text-center p-4">
                            <div class="feature-icon">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </div>
                            <h5 class="fw-bold">Upload 20MB</h5>
                            <p class="text-muted">Support file besar dengan Cloudinary integration.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-4">
                    <div class="card h-100 border-0">
                        <div class="card-body text-center p-4">
                            <div class="feature-icon">
                                <i class="fas fa-code"></i>
                            </div>
                            <h5 class="fw-bold">File Manager</h5>
                            <p class="text-muted">Edit file langsung di browser dengan live preview.</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-4">
                    <div class="card h-100 border-0">
                        <div class="card-body text-center p-4">
                            <div class="feature-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <h5 class="fw-bold">Live Statistics</h5>
                            <p class="text-muted">Pantau traffic website Anda dengan statistik real-time.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Changelog -->
            <div class="row mb-5" id="changelog">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header bg-light">
                            <h4 class="mb-0"><i class="fas fa-history me-2"></i>Changelog v2.1</h4>
                        </div>
                        <div class="card-body">
                            <div class="changelog-item">
                                <span class="changelog-badge">NEW</span>
                                <strong>Cloudinary Integration</strong>
                                <p class="text-muted mb-1">Upload file hingga 20MB dengan Cloudinary CDN</p>
                                <small class="text-muted">27 Des 2024</small>
                            </div>
                            <div class="changelog-item">
                                <span class="changelog-badge">NEW</span>
                                <strong>Delete File & Folder</strong>
                                <p class="text-muted mb-1">Fitur hapus file dan folder dengan konfirmasi</p>
                                <small class="text-muted">27 Des 2024</small>
                            </div>
                            <div class="changelog-item">
                                <span class="changelog-badge">NEW</span>
                                <strong>Domain Suggestions</strong>
                                <p class="text-muted mb-1">Saran domain alternatif jika nama sudah dipakai</p>
                                <small class="text-muted">27 Des 2024</small>
                            </div>
                            <div class="changelog-item">
                                <span class="changelog-badge">IMPROVED</span>
                                <strong>File Manager</strong>
                                <p class="text-muted mb-1">Struktur folder yang lebih jelas dengan breadcrumb</p>
                                <small class="text-muted">26 Des 2024</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dashboard (After Login) -->
            <div class="row d-none" id="dashboard">
                <!-- Sidebar -->
                <div class="col-md-3">
                    <div class="card mb-4">
                        <div class="card-body">
                            <div class="d-flex align-items-center mb-3">
                                <i class="fas fa-user-circle fa-2x text-muted me-3"></i>
                                <div>
                                    <h6 class="mb-0 fw-bold" id="userEmail"></h6>
                                    <small class="text-muted">Free Plan</small>
                                </div>
                            </div>
                            <div class="mb-3">
                                <div class="progress" style="height: 8px;">
                                    <div class="progress-bar bg-primary" id="projectLimitBar" style="width: 0%"></div>
                                </div>
                                <small class="text-muted" id="projectLimitText">0/5 website</small>
                            </div>
                            <button class="btn btn-primary w-100 mb-2" onclick="showAddProjectModal()">
                                <i class="fas fa-plus me-2"></i>Website Baru
                            </button>
                            <button class="btn btn-outline-danger w-100" onclick="logout()">
                                <i class="fas fa-sign-out-alt me-2"></i>Logout
                            </button>
                        </div>
                    </div>

                    <!-- Project List -->
                    <div class="card mb-4">
                        <div class="card-header bg-light">
                            <i class="fas fa-globe me-2"></i>Website Saya
                        </div>
                        <div class="card-body p-0">
                            <ul class="list-group list-group-flush" id="projectList">
                                <!-- Projects loaded here -->
                            </ul>
                        </div>
                    </div>
                    
                    <!-- Quick Stats -->
                    <div class="card">
                        <div class="card-header bg-light">
                            <i class="fas fa-chart-bar me-2"></i>Quick Stats
                        </div>
                        <div class="card-body">
                            <div class="text-center mb-3">
                                <canvas id="quickStatsChart" width="200" height="200"></canvas>
                            </div>
                            <div class="d-flex justify-content-between">
                                <div class="text-center">
                                    <h5 class="mb-0" id="totalProjects">0</h5>
                                    <small class="text-muted">Projects</small>
                                </div>
                                <div class="text-center">
                                    <h5 class="mb-0" id="totalFiles">0</h5>
                                    <small class="text-muted">Files</small>
                                </div>
                                <div class="text-center">
                                    <h5 class="mb-0" id="totalTraffic">0</h5>
                                    <small class="text-muted">Visits</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Main Content -->
                <div class="col-md-9">
                    <!-- File Manager -->
                    <div class="card mb-4 d-none" id="fileManager">
                        <div class="card-header bg-light d-flex justify-content-between align-items-center">
                            <div>
                                <i class="fas fa-folder text-warning me-2"></i>
                                <span id="currentProjectName" class="fw-bold"></span>
                                <small class="text-muted ms-2" id="currentProjectUrl"></small>
                            </div>
                            <div class="btn-group">
                                <button class="btn btn-sm btn-success" onclick="showUploadModal()">
                                    <i class="fas fa-upload me-1"></i> Upload
                                </button>
                                <button class="btn btn-sm btn-outline-primary" onclick="showNewFolderModal()">
                                    <i class="fas fa-folder-plus"></i> Folder
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="showDeleteProjectModal()">
                                    <i class="fas fa-trash"></i> Hapus
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <!-- Breadcrumb -->
                            <nav aria-label="breadcrumb" id="breadcrumbNav">
                                <ol class="breadcrumb">
                                    <li class="breadcrumb-item">
                                        <a href="#" onclick="goToRoot()">
                                            <i class="fas fa-home"></i> Root
                                        </a>
                                    </li>
                                </ol>
                                <span class="current-path" id="currentPathDisplay">/</span>
                            </nav>

                            <!-- File Explorer -->
                            <div class="file-explorer mb-4">
                                <div class="d-flex align-items-center mb-3">
                                    <i class="fas fa-folder-open text-warning me-2"></i>
                                    <h6 class="mb-0">File Explorer</h6>
                                    <button class="btn btn-sm btn-outline-primary ms-auto" onclick="refreshFileList()">
                                        <i class="fas fa-sync-alt"></i>
                                    </button>
                                </div>
                                <div id="fileTree">
                                    <!-- File tree will be loaded here -->
                                </div>
                            </div>

                            <!-- Live Preview -->
                            <div class="card mb-4">
                                <div class="card-header bg-light">
                                    <i class="fas fa-eye me-2"></i>Live Preview
                                    <button class="btn btn-sm btn-outline-primary float-end" onclick="refreshPreview()">
                                        <i class="fas fa-sync-alt"></i> Refresh
                                    </button>
                                </div>
                                <div class="card-body p-0">
                                    <iframe id="livePreviewFrame" src="about:blank" style="width: 100%; height: 400px; border: none;"></iframe>
                                </div>
                            </div>

                            <!-- Statistics -->
                            <div class="card">
                                <div class="card-header bg-light">
                                    <i class="fas fa-chart-line me-2"></i>Statistics
                                    <select class="form-select form-select-sm float-end" style="width: auto;" id="statsPeriod" onchange="loadStatistics()">
                                        <option value="today">Today</option>
                                        <option value="week">This Week</option>
                                        <option value="month">This Month</option>
                                    </select>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-3 mb-3">
                                            <div class="stats-card">
                                                <h6><i class="fas fa-eye me-2"></i>Views</h6>
                                                <h3 id="statViews">0</h3>
                                                <small>Today</small>
                                            </div>
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <div class="stats-card">
                                                <h6><i class="fas fa-users me-2"></i>Visitors</h6>
                                                <h3 id="statVisitors">0</h3>
                                                <small>Unique</small>
                                            </div>
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <div class="stats-card">
                                                <h6><i class="fas fa-file me-2"></i>Files</h6>
                                                <h3 id="statFiles">0</h3>
                                                <small>Total</small>
                                            </div>
                                        </div>
                                        <div class="col-md-3 mb-3">
                                            <div class="stats-card">
                                                <h6><i class="fas fa-database me-2"></i>Storage</h6>
                                                <h3 id="statStorage">0 KB</h3>
                                                <small>Used</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mt-3">
                                        <canvas id="trafficChart" height="100"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Editor -->
                    <div class="card d-none" id="editorSection">
                        <div class="card-header bg-light d-flex justify-content-between align-items-center">
                            <span id="editorFileName" class="fw-bold"></span>
                            <div>
                                <button class="btn btn-sm btn-success me-2" onclick="saveFile()">
                                    <i class="fas fa-save me-1"></i> Simpan
                                </button>
                                <button class="btn btn-sm btn-secondary" onclick="closeEditor()">
                                    <i class="fas fa-times me-1"></i> Tutup
                                </button>
                            </div>
                        </div>
                        <div class="card-body p-0">
                            <div id="codeEditor"></div>
                        </div>
                    </div>

                    <!-- Welcome Dashboard -->
                    <div class="card" id="welcomeDashboard">
                        <div class="card-body text-center py-5">
                            <div class="mb-4">
                                <i class="fas fa-cloud-upload-alt fa-4x text-muted"></i>
                            </div>
                            <h3 class="mb-3">Selamat Datang di PGXL v2.1</h3>
                            <p class="text-muted mb-4">Pilih website dari sidebar atau buat website baru</p>
                            <div class="row text-start">
                                <div class="col-md-6 mb-2">
                                    <i class="fas fa-check text-success me-2"></i> Upload file hingga 20MB
                                </div>
                                <div class="col-md-6 mb-2">
                                    <i class="fas fa-check text-success me-2"></i> Cloudinary integration
                                </div>
                                <div class="col-md-6 mb-2">
                                    <i class="fas fa-check text-success me-2"></i> Hapus file & folder
                                </div>
                                <div class="col-md-6 mb-2">
                                    <i class="fas fa-check text-success me-2"></i> Live preview website
                                </div>
                                <div class="col-md-6 mb-2">
                                    <i class="fas fa-check text-success me-2"></i> Statistics real-time
                                </div>
                                <div class="col-md-6 mb-2">
                                    <i class="fas fa-check text-success me-2"></i> No ads, 100% free
                                </div>
                            </div>
                            
                            <!-- Quick Start Guide -->
                            <div class="mt-5">
                                <div class="row justify-content-center">
                                    <div class="col-md-8">
                                        <div class="card border-primary">
                                            <div class="card-body">
                                                <h5 class="card-title text-primary">
                                                    <i class="fas fa-play-circle me-2"></i>Quick Start
                                                </h5>
                                                <ol class="text-start">
                                                    <li class="mb-2">Klik "Website Baru" di sidebar</li>
                                                    <li class="mb-2">Beri nama project Anda</li>
                                                    <li class="mb-2">Upload file HTML/CSS/JS (max 20MB)</li>
                                                    <li class="mb-2">Akses website di subdomain Anda</li>
                                                    <li>Kelola file dengan file manager</li>
                                                </ol>
                                                <div class="alert alert-info mt-3">
                                                    <i class="fas fa-info-circle me-2"></i>
                                                    <strong>New:</strong> File disimpan di Cloudinary CDN untuk performa maksimal
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 404 Not Found Page -->
                    <div class="card d-none" id="notFoundPage">
                        <div class="card-body not-found">
                            <div class="not-found-icon">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <h1 class="mb-3">404 - Page Not Found</h1>
                            <p class="text-muted mb-4">Halaman yang Anda cari tidak ditemukan.</p>
                            <button class="btn btn-primary" onclick="goToDashboard()">
                                <i class="fas fa-home me-2"></i>Kembali ke Dashboard
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Terms & Privacy -->
            <div class="row mt-5 d-none" id="legalSection">
                <div class="col-12">
                    <!-- Terms of Service -->
                    <div class="card mb-4">
                        <div class="card-header bg-light">
                            <h4 class="mb-0"><i class="fas fa-file-contract me-2"></i>Terms of Service</h4>
                        </div>
                        <div class="card-body">
                            <div class="terms-content">
                                <h5>1. Acceptance of Terms</h5>
                                <p>Dengan menggunakan PGXL.WEB.ID, Anda menyetujui syarat dan ketentuan ini.</p>
                                
                                <h5>2. Description of Service</h5>
                                <p>PGXL.WEB.ID menyediakan layanan hosting website statis gratis dengan subdomain custom.</p>
                                
                                <h5>3. User Responsibilities</h5>
                                <p>Pengguna bertanggung jawab atas semua konten yang diunggah dan harus mematuhi hukum yang berlaku.</p>
                                
                                <h5>4. Prohibited Content</h5>
                                <p>Dilarang mengunggah konten ilegal, malware, spam, atau konten yang melanggar hak cipta.</p>
                                
                                <h5>5. Account Limits</h5>
                                <p>Setiap akun dibatasi maksimal 5 website pada paket gratis.</p>
                                
                                <h5>6. Service Availability</h5>
                                <p>Kami berusaha menjaga layanan tetap online tetapi tidak menjamin uptime 100%.</p>
                                
                                <h5>7. Termination</h5>
                                <p>Kami berhak menangguhkan akun yang melanggar terms of service.</p>
                                
                                <h5>8. Limitation of Liability</h5>
                                <p>PGXL.WEB.ID tidak bertanggung jawab atas kerugian yang timbul dari penggunaan layanan.</p>
                                
                                <h5>9. Changes to Terms</h5>
                                <p>Kami dapat mengubah terms of service kapan saja tanpa pemberitahuan sebelumnya.</p>
                                
                                <h5>10. Governing Law</h5>
                                <p>Terms ini diatur oleh hukum Indonesia.</p>
                                
                                <h5>11. Contact Information</h5>
                                <p>Untuk pertanyaan hubungi: spctacularstudio@gmail.com</p>
                                
                                <h5>12. Effective Date</h5>
                                <p>Terms ini efektif sejak 1 Januari 2025.</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Privacy Policy -->
                    <div class="card">
                        <div class="card-header bg-light">
                            <h4 class="mb-0"><i class="fas fa-shield-alt me-2"></i>Privacy Policy</h4>
                        </div>
                        <div class="card-body">
                            <div class="terms-content">
                                <h5>1. Information Collection</h5>
                                <p>Kami mengumpulkan informasi email dan data project yang Anda buat.</p>
                                
                                <h5>2. Use of Information</h5>
                                <p>Informasi digunakan untuk mengoperasikan layanan dan mengirim notifikasi penting.</p>
                                
                                <h5>3. Data Storage</h5>
                                <p>Data disimpan di Firebase dan Cloudinary dengan keamanan standar industri.</p>
                                
                                <h5>4. Cookies</h5>
                                <p>Kami menggunakan cookies untuk sesi login dan preferensi pengguna.</p>
                                
                                <h5>5. Third-Party Services</h5>
                                <p>Kami menggunakan Firebase (Google) dan Cloudinary untuk layanan storage.</p>
                                
                                <h5>6. Data Security</h5>
                                <p>Kami menerapkan langkah-langkah keamanan untuk melindungi data Anda.</p>
                                
                                <h5>7. User Rights</h5>
                                <p>Anda dapat menghapus akun dan data Anda kapan saja melalui dashboard.</p>
                                
                                <h5>8. Children's Privacy</h5>
                                <p>Layanan tidak ditujukan untuk anak di bawah 13 tahun.</p>
                                
                                <h5>9. Data Retention</h5>
                                <p>Data dipertahankan selama akun aktif dan dihapus setelah akun dinonaktifkan.</p>
                                
                                <h5>10. Policy Updates</h5>
                                <p>Privacy policy dapat diperbarui kapan saja.</p>
                                
                                <h5>11. International Transfer</h5>
                                <p>Data mungkin diproses di luar negara tempat tinggal Anda.</p>
                                
                                <h5>12. Contact Us</h5>
                                <p>Untuk pertanyaan privasi: spctacularstudio@gmail.com</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <div class="container">
                <div class="row">
                    <div class="col-md-4 mb-4">
                        <h5 class="mb-3">
                            <i class="fas fa-server me-2 text-primary"></i>PGXL.WEB.ID v2.1
                        </h5>
                        <p class="mb-2">Free static hosting untuk developer dan creator.</p>
                        <p class="mb-2"><strong>100% Free Forever - No Ads!</strong></p>
                        <div class="mt-3">
                            <a href="mailto:spctacularstudio@gmail.com" class="text-decoration-none text-muted me-3">
                                <i class="fas fa-envelope me-1"></i> Contact
                            </a>
                            <a href="https://saweria.co/omedonation" target="_blank" class="text-decoration-none text-muted">
                                <i class="fas fa-donate me-1"></i> Donate
                            </a>
                        </div>
                    </div>
                    <div class="col-md-4 mb-4">
                        <h5 class="mb-3">Quick Links</h5>
                        <ul class="list-unstyled">
                            <li class="mb-2">
                                <a href="#features" class="text-decoration-none text-muted">Fitur</a>
                            </li>
                            <li class="mb-2">
                                <a href="#changelog" class="text-decoration-none text-muted">Changelog</a>
                            </li>
                            <li class="mb-2">
                                <a href="#" onclick="showLegal('tos')" class="text-decoration-none text-muted">Terms</a>
                            </li>
                            <li>
                                <a href="#" onclick="showLegal('privacy')" class="text-decoration-none text-muted">Privacy</a>
                            </li>
                        </ul>
                    </div>
                    <div class="col-md-4 mb-4">
                        <h5 class="mb-3">Powered By</h5>
                        <div class="d-flex align-items-center mb-2">
                            <img src="https://res.cloudinary.com/dqrp70g9u/image/upload/v1606587436/firebase_logo.png" height="20" class="me-2">
                            <span class="small">Firebase</span>
                        </div>
                        <div class="d-flex align-items-center">
                            <img src="https://res.cloudinary.com/dqrp70g9u/image/upload/v1606587436/cloudinary_logo.png" height="20" class="me-2">
                            <span class="small">Cloudinary</span>
                        </div>
                        <p class="small text-muted mt-3">
                            <strong>100% No Ads Policy:</strong> Kami tidak menampilkan iklan sama sekali.
                        </p>
                    </div>
                </div>
                
                <div class="row mt-4">
                    <div class="col-12 text-center">
                        <p class="mb-0 text-muted">
                            üöÄ Powered by PGXL.WEB.ID v2.1 | Made with ‚ù§Ô∏è for the developer community
                        </p>
                    </div>
                </div>
            </div>
        </footer>

        <!-- Modals -->
        <div class="modal fade" id="authModal" tabindex="-1">
            <div class="modal-dialog modal-sm">
                <div class="modal-content">
                    <div class="modal-header border-0">
                        <h5 class="modal-title">Login ke PGXL</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body text-center">
                        <button class="btn btn-outline-dark w-100 mb-3" onclick="signInWithGoogle()">
                            <i class="fab fa-google me-2"></i> Google
                        </button>
                        <button class="btn btn-dark w-100" onclick="signInWithGithub()">
                            <i class="fab fa-github me-2"></i> GitHub
                        </button>
                        <hr class="my-4">
                        <p class="text-muted small">
                            Dengan login, kamu menyetujui Terms of Service kami.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Project Modal -->
        <div class="modal fade" id="addProjectModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">‚ûï Website Baru</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label fw-bold">Nama Project</label>
                            <input type="text" class="form-control" id="projectName" placeholder="my-portfolio">
                            <div class="form-text mt-2">
                                Domain kamu: <span class="project-domain" id="domainPreview">...</span>
                            </div>
                            <div id="domainSuggestions" class="mt-2"></div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label fw-bold">Deskripsi (opsional)</label>
                            <textarea class="form-control" id="projectDescription" rows="2" placeholder="Website portfolio saya..."></textarea>
                        </div>
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>Free Plan Limit:</strong> Maksimal 5 website per akun
                        </div>
                    </div>
                    <div class="modal-footer border-0">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                        <button type="button" class="btn btn-primary" onclick="createProject()">Buat Website</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Upload Modal -->
        <div class="modal fade" id="uploadModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title"><i class="fas fa-upload me-2"></i>Upload File</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label fw-bold">Pilih File</label>
                            <input type="file" class="form-control" id="fileInput" multiple>
                            <small class="text-muted">Max file size: 20MB. Support: HTML, CSS, JS, Images, PDF, ZIP</small>
                        </div>
                        <div class="mb-3">
                            <label class="form-label fw-bold">Upload ke Folder</label>
                            <input type="text" class="form-control" id="uploadPath" value="/" placeholder="/images/">
                            <small class="text-muted">Current path: <span id="currentPathPreview">/</span></small>
                        </div>
                        <div id="fileList" class="mb-3"></div>
                    </div>
                    <div class="modal-footer border-0">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                        <button type="button" class="btn btn-primary" onclick="startUpload()">Upload Files</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- New Folder Modal -->
        <div class="modal fade" id="newFolderModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title"><i class="fas fa-folder-plus me-2"></i>Folder Baru</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label fw-bold">Nama Folder</label>
                            <input type="text" class="form-control" id="folderName" placeholder="images">
                        </div>
                        <div class="mb-3">
                            <label class="form-label fw-bold">Lokasi</label>
                            <input type="text" class="form-control" id="folderPath" value="/" readonly>
                        </div>
                    </div>
                    <div class="modal-footer border-0">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                        <button type="button" class="btn btn-primary" onclick="createNewFolder()">Buat Folder</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Delete Project Modal -->
        <div class="modal fade" id="deleteProjectModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title text-danger"><i class="fas fa-trash me-2"></i>Hapus Website</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <p>Apakah Anda yakin ingin menghapus website <strong id="deleteProjectName"></strong>?</p>
                        <p class="text-danger">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            Tindakan ini tidak dapat dibatalkan! Semua file dan data akan dihapus permanen.
                        </p>
                        <div class="form-check mt-3">
                            <input class="form-check-input" type="checkbox" id="confirmDelete">
                            <label class="form-check-label" for="confirmDelete">
                                Saya mengerti dan ingin menghapus website ini
                            </label>
                        </div>
                    </div>
                    <div class="modal-footer border-0">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                        <button type="button" class="btn btn-danger" onclick="deleteCurrentProject()" disabled id="deleteConfirmBtn">
                            <i class="fas fa-trash me-2"></i>Hapus Permanen
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Delete File/Folder Modal -->
        <div class="modal fade" id="deleteFileModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title text-danger"><i class="fas fa-trash me-2"></i>Hapus</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <p>Apakah Anda yakin ingin menghapus <strong id="deleteItemName"></strong>?</p>
                        <p id="deleteItemType" class="text-muted"></p>
                        <p class="text-danger">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            Tindakan ini tidak dapat dibatalkan!
                        </p>
                        <div class="form-check mt-3">
                            <input class="form-check-input" type="checkbox" id="confirmFileDelete">
                            <label class="form-check-label" for="confirmFileDelete">
                                Ya, saya yakin ingin menghapus
                            </label>
                        </div>
                    </div>
                    <div class="modal-footer border-0">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                        <button type="button" class="btn btn-danger" onclick="confirmDeleteItem()" disabled id="deleteFileConfirmBtn">
                            <i class="fas fa-trash me-2"></i>Hapus Permanen
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ext-language_tools.js"></script>
    
    <script>
    // ============================================
    // PROJECT SUBDOMAIN DETECTION & ROUTING
    // ============================================
    
    // Save original hostname BEFORE any redirects
    const ORIGINAL_HOSTNAME = window.location.hostname;
    
    // Function to extract project ID from hostname
    function extractProjectIdFromHostname() {
        const hostname = ORIGINAL_HOSTNAME;
        
        // Check if it matches pattern: something.pgxl.web.id
        const match = hostname.match(/^([a-z0-9-]+)\.pgxl\.web\.id$/);
        
        if (match && match[1]) {
            const projectId = match[1];
            // Skip if it's special domains
            if (projectId === 'www' || projectId === 'app' || projectId === 'pgxl') {
                return null;
            }
            return projectId;
        }
        
        return null;
    }
    
    // ============================================
    // FIREBASE CONFIG
    // ============================================
    
    const firebaseConfig = {
        apiKey: "AIzaSyCH5nmdOf3tL7HNjx9kqBmISgaylG8vvOU",
        authDomain: "pgxl-4567a.firebaseapp.com",
        projectId: "pgxl-4567a",
        storageBucket: "pgxl-4567a.firebasestorage.app",
        messagingSenderId: "545920930826",
        appId: "1:545920930826:web:18458fd3382a83f17abbf3",
        measurementId: "G-1Y4E635M4R"
    };
    
    // ============================================
    // CLOUDINARY CONFIG
    // ============================================
    
    const cloudinaryConfig = {
        cloudName: 'dqrp70g9u',
        apiKey: '774675621854889',
        apiSecret: 'q0yV60ZnO9thyqsJDo33bmoW6uc',
        uploadPreset: 'pgxl_uploads' // Create this in Cloudinary Dashboard
    };
    
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    
    // ============================================
    // PROJECT VIEWER FUNCTIONS
    // ============================================
    
    async function serveProject(projectId) {
        try {
            console.log('üì¶ Loading project:', projectId);
            
            // Show loading screen
            document.getElementById('projectViewerContainer').style.display = 'block';
            document.getElementById('projectViewer').innerHTML = `
                <div style="
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    justify-content: center;
                    height: 100vh;
                    background: white;
                ">
                    <style>
                        @keyframes spin {
                            0% { transform: rotate(0deg); }
                            100% { transform: rotate(360deg); }
                        }
                        .loading-spinner {
                            width: 60px;
                            height: 60px;
                            border: 6px solid #f3f3f3;
                            border-top: 6px solid #667eea;
                            border-radius: 50%;
                            animation: spin 1s linear infinite;
                            margin-bottom: 20px;
                        }
                    </style>
                    <div class="loading-spinner"></div>
                    <h3 style="color: #333; margin-bottom: 10px;">Loading ${projectId}.pgxl.web.id</h3>
                    <p style="color: #666; font-size: 14px;">Powered by PGXL.WEB.ID - No Ads!</p>
                </div>
            `;
            
            // Hide main app
            document.getElementById('mainAppContent').style.display = 'none';
            
            // Load project from Firestore
            const doc = await db.collection('projects').doc(projectId).get();
            
            if (!doc.exists) {
                showProjectError(`Project "${projectId}" tidak ditemukan.`);
                return;
            }
            
            const project = doc.data();
            const files = project.files || {};
            
            // Find index.html
            const indexKey = Object.keys(files).find(key => 
                key.replace(/___/g, '/') === 'index.html'
            );
            
            if (!indexKey) {
                showProjectInfoPage(project);
                return;
            }
            
            const indexFile = files[indexKey];
            
            // Build complete HTML with all assets
            let htmlContent = indexFile.content;
            
            // Collect CSS and JS
            let allCSS = '';
            let allJS = '';
            
            Object.keys(files).forEach(key => {
                const decodedPath = key.replace(/___/g, '/');
                const file = files[key];
                
                if (file.type === 'css' || decodedPath.endsWith('.css')) {
                    allCSS += `<style>${file.content}</style>\n`;
                }
                
                if (file.type === 'js' || decodedPath.endsWith('.js')) {
                    allJS += `<script>${file.content}<\/script>\n`;
                }
                
                // Handle Cloudinary images
                if (file.isCloudinary && file.cloudinaryUrl && 
                    (file.type.includes('image') || decodedPath.match(/\.(jpg|jpeg|png|gif|webp)$/i))) {
                    // Replace image references in HTML
                    const fileName = decodedPath.split('/').pop();
                    const regex = new RegExp(`["']${fileName}["']`, 'gi');
                    htmlContent = htmlContent.replace(regex, `"${file.cloudinaryUrl}"`);
                }
            });
            
            // Inject into HTML
            htmlContent = htmlContent.replace('</head>', allCSS + '</head>');
            htmlContent = htmlContent.replace('</body>', allJS + '</body>');
            
            // Add PGXL branding banner (NO ADS VERSION)
            const pgxlBanner = `
                <div class="pgxl-banner" id="pgxlBanner">
                    üöÄ Hosted for FREE on <a href="https://pgxl.web.id" target="_blank" style="color: white; text-decoration: underline;">PGXL.WEB.ID</a> - No Ads!
                    <button onclick="this.parentElement.style.display='none'" style="
                        position: absolute;
                        right: 15px;
                        background: rgba(255,255,255,0.2);
                        border: none;
                        color: white;
                        width: 24px;
                        height: 24px;
                        border-radius: 50%;
                        cursor: pointer;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                    ">√ó</button>
                </div>
                <script>
                    setTimeout(() => {
                        const banner = document.getElementById('pgxlBanner');
                        if (banner) banner.style.opacity = '0.7';
                    }, 15000);
                <\/script>
            `;
            
            htmlContent = htmlContent.replace('</body>', pgxlBanner + '</body>');
            
            // Display the project
            document.getElementById('projectViewer').innerHTML = htmlContent;
            
        } catch (error) {
            console.error('Error serving project:', error);
            showProjectError(`Error loading project: ${error.message}`);
        }
    }
    
    function showProjectError(message) {
        document.getElementById('projectViewer').innerHTML = `
            <div style="
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                height: 100vh;
                background: white;
                padding: 20px;
                text-align: center;
            ">
                <div style="font-size: 60px; color: #ef4444; margin-bottom: 20px;">‚ùå</div>
                <h2 style="color: #333; margin-bottom: 10px;">Project Error</h2>
                <p style="color: #666; margin-bottom: 30px; max-width: 400px;">${message}</p>
                <div style="display: flex; gap: 10px;">
                    <button onclick="location.reload()" style="
                        background: #667eea;
                        color: white;
                        border: none;
                        padding: 10px 20px;
                        border-radius: 5px;
                        cursor: pointer;
                    ">Refresh</button>
                    <button onclick="window.location.href = 'https://pgxl.web.id'" style="
                        background: #10b981;
                        color: white;
                        border: none;
                        padding: 10px 20px;
                        border-radius: 5px;
                        cursor: pointer;
                    ">Go to PGXL</button>
                </div>
            </div>
        `;
    }
    
    function showProjectInfoPage(project) {
        document.getElementById('projectViewer').innerHTML = `
            <!DOCTYPE html>
            <html>
            <head>
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <title>${project.name || 'Project'} - PGXL.WEB.ID</title>
                <style>
                    body {
                        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                        min-height: 100vh;
                        margin: 0;
                        padding: 20px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                    }
                    .container {
                        background: white;
                        border-radius: 16px;
                        padding: 40px;
                        max-width: 600px;
                        width: 100%;
                        box-shadow: 0 20px 60px rgba(0,0,0,0.1);
                        text-align: center;
                    }
                    h1 {
                        color: #667eea;
                        margin-bottom: 10px;
                    }
                    .domain {
                        font-family: 'Courier New', monospace;
                        background: #f1f5f9;
                        padding: 10px 15px;
                        border-radius: 8px;
                        display: inline-block;
                        margin: 15px 0;
                    }
                    .btn {
                        display: inline-block;
                        background: #667eea;
                        color: white;
                        padding: 12px 30px;
                        border-radius: 8px;
                        text-decoration: none;
                        margin-top: 20px;
                        border: none;
                        cursor: pointer;
                        font-size: 16px;
                    }
                </style>
            </head>
            <body>
                <div class="container">
                    <h1>${project.name || 'Untitled Project'}</h1>
                    <div class="domain">${project.domain}</div>
                    <p>${project.description || 'No description available'}</p>
                    
                    <div style="background: #fef3c7; padding: 20px; border-radius: 10px; margin: 25px 0; border-left: 4px solid #f59e0b;">
                        <h3 style="color: #d97706; margin-top: 0;">
                            <i class="fas fa-info-circle"></i> Project Information
                        </h3>
                        <p>This project is hosted on PGXL.WEB.ID but doesn't have an index.html file yet.</p>
                    </div>
                    
                    <button class="btn" onclick="window.location.href = 'https://pgxl.web.id'">
                        <i class="fas fa-edit"></i> Edit on PGXL Dashboard
                    </button>
                    
                    <p style="margin-top: 30px; color: #94a3b8; font-size: 14px;">
                        üöÄ Powered by <a href="https://pgxl.web.id" style="color: #667eea;">PGXL.WEB.ID</a> - No Ads!
                    </p>
                </div>
            </body>
            </html>
        `;
    }
    
    // ============================================
    // MAIN APP INITIALIZATION
    // ============================================
    
    // Check if we should show project or main app
    document.addEventListener('DOMContentLoaded', function() {
        const projectId = extractProjectIdFromHostname();
        
        if (projectId) {
            console.log('üéØ Showing project viewer for:', projectId);
            serveProject(projectId);
        } else {
            console.log('üè† Showing main application');
            initMainApp();
        }
    });
    
    // ============================================
    // MAIN APP FUNCTIONS
    // ============================================
    
    // Providers
    const googleProvider = new firebase.auth.GoogleAuthProvider();
    const githubProvider = new firebase.auth.GithubAuthProvider();
    
    // Global variables
    let currentUser = null;
    let currentProject = null;
    let currentPath = '/';
    let editor = null;
    let originalContent = '';
    let trafficChart = null;
    let statsChart = null;
    let itemToDelete = null;
    let breadcrumbItems = [];
    
    function initMainApp() {
        // Your existing app initialization code
        document.getElementById('mainAppContent').style.display = 'block';
        document.getElementById('projectViewerContainer').style.display = 'none';
        
        // Initialize domain preview
        document.getElementById('projectName')?.addEventListener('input', window.updateDomainPreview);
        if (document.getElementById('projectName')) {
            window.updateDomainPreview();
        }
        
        // Delete confirmation checkbox
        document.getElementById('confirmDelete')?.addEventListener('change', function() {
            document.getElementById('deleteConfirmBtn').disabled = !this.checked;
        });
        
        // File input change handler
        document.getElementById('fileInput')?.addEventListener('change', function() {
            showFileList(this.files);
        });
        
        // Initialize Ace Editor
        ace.config.set('basePath', 'https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/');
        
        // Start auth listener
        auth.onAuthStateChanged((user) => {
            if (user) {
                if (currentUser && currentUser.uid !== user.uid) {
                    // Different user logged in, show refresh button
                    document.getElementById('refreshBtn').classList.remove('d-none');
                }
                currentUser = user;
                showDashboard();
            } else {
                currentUser = null;
                showWelcome();
            }
        });
        
        // Auto-refresh every 30 seconds for live updates
        setInterval(() => {
            if (currentProject && document.getElementById('fileManager').classList.contains('d-none') === false) {
                refreshStatistics();
            }
        }, 30000);
    }
    
    // üî• FUNCTIONS
    window.showAuthModal = function() {
        new bootstrap.Modal(document.getElementById('authModal')).show();
    };
    
    window.signInWithGoogle = function() {
        auth.signInWithPopup(googleProvider)
            .then(() => {
                bootstrap.Modal.getInstance(document.getElementById('authModal')).hide();
            })
            .catch(error => {
                alert('Google login error: ' + error.message);
            });
    };
    
    window.signInWithGithub = function() {
        auth.signInWithPopup(githubProvider)
            .then(() => {
                bootstrap.Modal.getInstance(document.getElementById('authModal')).hide();
            })
            .catch(error => {
                alert('GitHub login error: ' + error.message);
            });
    };
    
    window.logout = function() {
        if (confirm('Yakin logout?')) {
            auth.signOut();
        }
    };
    
    window.showAddProjectModal = function() {
        document.getElementById('projectName').value = '';
        document.getElementById('projectDescription').value = '';
        window.updateDomainPreview();
        new bootstrap.Modal(document.getElementById('addProjectModal')).show();
    };
    
    window.updateDomainPreview = async function() {
        const name = document.getElementById('projectName').value.toLowerCase()
            .replace(/[^a-z0-9-]/g, '-')
            .replace(/-+/g, '-')
            .replace(/^-|-$/g, '') || 'myproject';
        
        const domainElement = document.getElementById('domainPreview');
        const suggestionsContainer = document.getElementById('domainSuggestions');
        
        // Check if domain exists
        const doc = await db.collection('projects').doc(name).get();
        
        if (doc.exists) {
            domainElement.innerHTML = `<span class="text-danger">${name}.pgxl.web.id (sudah digunakan)</span>`;
            
            // Generate suggestions
            const suggestions = await suggestDomains(name);
            
            if (suggestions.length > 0) {
                suggestionsContainer.innerHTML = `
                    <div class="mt-2">
                        <small class="text-muted">Saran domain tersedia:</small><br>
                    </div>
                `;
                
                suggestions.forEach(s => {
                    const badge = document.createElement('span');
                    badge.className = 'badge bg-success me-2 mb-1 domain-suggestion-badge';
                    badge.style.cursor = 'pointer';
                    badge.textContent = `${s}.pgxl.web.id`;
                    badge.onclick = () => window.useSuggestedDomain(s);
                    suggestionsContainer.appendChild(badge);
                });
            } else {
                suggestionsContainer.innerHTML = `
                    <div class="mt-2">
                        <small class="text-muted">Coba nama yang berbeda</small>
                    </div>
                `;
            }
        } else {
            domainElement.textContent = name + '.pgxl.web.id';
            suggestionsContainer.innerHTML = '';
        }
    };
    
    async function suggestDomains(baseName) {
        const suggestions = [];
        const alternatives = [
            `${baseName}-project`,
            `${baseName}-site`,
            `${baseName}${Math.floor(Math.random() * 1000)}`,
            `my-${baseName}`,
            `${baseName}-web`
        ];
        
        // Check availability for first 3 alternatives
        for (let i = 0; i < Math.min(3, alternatives.length); i++) {
            const alt = alternatives[i];
            const doc = await db.collection('projects').doc(alt).get();
            if (!doc.exists) {
                suggestions.push(alt);
            }
        }
        
        return suggestions;
    }
    
    window.useSuggestedDomain = function(domainName) {
        document.getElementById('projectName').value = domainName;
        window.updateDomainPreview();
    };
    
    window.createProject = async function() {
        const name = document.getElementById('projectName').value;
        const description = document.getElementById('projectDescription').value;
        
        if (!name) {
            alert('Nama project harus diisi!');
            return;
        }
    
        const projectId = name.toLowerCase()
            .replace(/[^a-z0-9-]/g, '-')
            .replace(/-+/g, '-')
            .replace(/^-|-$/g, '');
        
        // Check project limit (max 5)
        const snapshot = await db.collection('projects')
            .where('owner', '==', currentUser.uid)
            .get();
        
        if (snapshot.size >= 5) {
            alert('‚ùå Anda sudah mencapai batas maksimal 5 website. Hapus website lama untuk membuat yang baru.');
            bootstrap.Modal.getInstance(document.getElementById('addProjectModal')).hide();
            return;
        }
        
        // Check if project already exists
        const existingDoc = await db.collection('projects').doc(projectId).get();
        if (existingDoc.exists) {
            alert('‚ùå Nama project sudah digunakan. Silakan pilih nama lain.');
            return;
        }
        
        // Default files
        const defaultFiles = {
            'index.html': {
                content: `<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${name} - PGXL.WEB.ID</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            border-radius: 16px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
        }
        h1 { 
            color: #667eea;
            margin-bottom: 20px;
            font-size: 2.5em;
            text-align: center;
        }
        p {
            margin-bottom: 20px;
            color: #64748b;
            text-align: center;
            font-size: 1.1em;
        }
        .pgxl-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 30px;
            border-radius: 50px;
            display: inline-block;
            margin: 30px auto;
            text-decoration: none;
            font-weight: 600;
            text-align: center;
            transition: transform 0.3s;
        }
        .pgxl-badge:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 40px 0;
        }
        .feature {
            background: #f8fafc;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid #eaeaea;
        }
        .feature i {
            font-size: 2.5em;
            color: #667eea;
            margin-bottom: 15px;
        }
        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 40px;
        }
        .logo i {
            font-size: 3em;
            color: #667eea;
        }
        .logo h2 {
            color: #667eea;
            font-size: 2.2em;
            margin: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">
            <i class="fas fa-server"></i>
            <h2>${name}</h2>
        </div>
        
        <h1>üéâ Selamat! Website Anda Sudah Online</h1>
        
        <p>Website ini dihosting secara <strong>GRATIS</strong> di <strong>PGXL.WEB.ID</strong>.<br>
        Anda dapat mengedit konten ini melalui dashboard PGXL.</p>
        
        <div class="features">
            <div class="feature">
                <i class="fas fa-bolt"></i>
                <h4>Deploy Instan</h4>
                <p>Upload file, langsung online</p>
            </div>
            <div class="feature">
                <i class="fas fa-cloud-upload-alt"></i>
                <h4>Upload 20MB</h4>
                <p>Support file besar dengan Cloudinary</p>
            </div>
            <div class="feature">
                <i class="fas fa-shield-alt"></i>
                <h4>Gratis 100%</h4>
                <p>Tidak ada biaya tersembunyi</p>
            </div>
        </div>
        
        <div style="text-align: center;">
            <a href="https://pgxl.web.id" target="_blank" class="pgxl-badge">
                üöÄ Powered by PGXL.WEB.ID v2.1 - No Ads!
            </a>
        </div>
        
        <p style="text-align: center; margin-top: 40px; color: #94a3b8; font-size: 0.9em;">
            <small>Domain: ${projectId}.pgxl.web.id | Dibuat dengan ‚ù§Ô∏è oleh PGXL.WEB.ID</small>
        </p>
    </div>
</body>
</html>`,
                type: 'html',
                size: 0,
                updated: new Date()
            },
            'style.css': {
                content: `/* Style untuk website ${name} - PGXL.WEB.ID */
body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    line-height: 1.6;
    color: #333;
    background-color: #f8fafc;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

h1, h2, h3, h4 {
    color: #667eea;
    font-weight: 600;
}

.btn-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 8px;
    font-weight: 500;
    text-decoration: none;
    display: inline-block;
    transition: all 0.3s ease;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
}

.pgxl-badge {
    background: #f8f9fa;
    border: 2px solid #667eea;
    padding: 20px;
    border-radius: 12px;
    text-align: center;
    margin: 30px 0;
}

/* Responsive */
@media (max-width: 768px) {
    .container {
        padding: 15px;
    }
}`,
                type: 'css',
                size: 0,
                updated: new Date()
            }
        };
    
        const projectData = {
            name: name,
            description: description || '',
            domain: projectId + '.pgxl.web.id',
            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            owner: currentUser.uid,
            ownerEmail: currentUser.email,
            files: {},
            traffic: {},
            stats: {
                views: 0,
                visitors: 0,
                files: 0,
                storage: 0,
                lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
            },
            updated: firebase.firestore.FieldValue.serverTimestamp()
        };
    
        // Escape paths for Firebase
        Object.keys(defaultFiles).forEach(key => {
            const escapedKey = key.replace(/\//g, '___');
            projectData.files[escapedKey] = defaultFiles[key];
            projectData.stats.files++;
            projectData.stats.storage += defaultFiles[key].content.length;
        });
    
        // Initialize traffic data for today
        const today = new Date().toISOString().split('T')[0];
        projectData.traffic[today] = { views: 0, visitors: 0 };
    
        try {
            await db.collection('projects').doc(projectId).set(projectData);
            alert('‚úÖ Website berhasil dibuat!');
            bootstrap.Modal.getInstance(document.getElementById('addProjectModal')).hide();
            window.loadProjects();
            window.openProject(projectId);
        } catch (error) {
            console.error('Create project error:', error);
            alert('‚ùå Error: ' + error.message);
        }
    };
    
    window.loadProjects = async function() {
        try {
            const snapshot = await db.collection('projects')
                .where('owner', '==', currentUser.uid)
                .orderBy('createdAt', 'desc')
                .get();
            
            const projectList = document.getElementById('projectList');
            projectList.innerHTML = '';
            
            // Update project limit
            const totalProjects = snapshot.size;
            const limitPercentage = (totalProjects / 5) * 100;
            
            document.getElementById('projectLimitBar').style.width = `${limitPercentage}%`;
            document.getElementById('projectLimitText').textContent = `${totalProjects}/5 website`;
            document.getElementById('totalProjects').textContent = totalProjects;
            
            let totalFiles = 0;
            let totalTraffic = 0;
            
            snapshot.forEach(doc => {
                const project = doc.data();
                const stats = project.stats || {};
                totalFiles += stats.files || 0;
                totalTraffic += stats.views || 0;
                
                const li = document.createElement('li');
                li.className = 'list-group-item list-group-item-action';
                li.innerHTML = '<div class="d-flex justify-content-between align-items-center">' +
                    '<div>' +
                        '<div class="fw-bold">' + project.name + '</div>' +
                        '<small class="text-muted">' + project.domain + '</small>' +
                    '</div>' +
                    '<div>' +
                        '<button class="btn btn-sm btn-outline-primary me-1" onclick="openProject(\'' + doc.id + '\')">' +
                            '<i class="fas fa-folder-open"></i>' +
                        '</button>' +
                    '</div>' +
                '</div>';
                projectList.appendChild(li);
            });
            
            document.getElementById('totalFiles').textContent = totalFiles;
            document.getElementById('totalTraffic').textContent = totalTraffic;
            
            // Update quick stats chart
            updateQuickStatsChart(totalProjects, totalFiles, totalTraffic);
            
            if (snapshot.empty) {
                projectList.innerHTML = '<li class="list-group-item text-center text-muted py-4">' +
                    '<i class="fas fa-folder-open fa-2x mb-3"></i>' +
                    '<p>Belum ada website</p>' +
                    '<button class="btn btn-sm btn-primary" onclick="showAddProjectModal()">' +
                        'Buat Website Pertama' +
                    '</button>' +
                '</li>';
            }
        } catch (error) {
            console.error('Error loading projects:', error);
        }
    };
    
    function updateQuickStatsChart(projects, files, traffic) {
        const ctx = document.getElementById('quickStatsChart').getContext('2d');
        
        if (statsChart) {
            statsChart.destroy();
        }
        
        statsChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Projects', 'Files', 'Visits'],
                datasets: [{
                    data: [projects, files, traffic],
                    backgroundColor: [
                        '#667eea',
                        '#10b981',
                        '#f59e0b'
                    ],
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `${context.label}: ${context.raw}`;
                            }
                        }
                    }
                }
            }
        });
    }
    
    window.openProject = function(projectId) {
        currentProject = projectId;
        currentPath = '/';
        breadcrumbItems = [];
        updateBreadcrumb();
        
        document.getElementById('welcomeDashboard').classList.add('d-none');
        document.getElementById('fileManager').classList.remove('d-none');
        document.getElementById('editorSection').classList.add('d-none');
        document.getElementById('notFoundPage').classList.add('d-none');
        
        db.collection('projects').doc(projectId).get().then(doc => {
            const project = doc.data();
            document.getElementById('currentProjectName').textContent = project.name;
            document.getElementById('deleteProjectName').textContent = project.name;
            document.getElementById('currentProjectUrl').innerHTML = 
                ' ‚Üí <a href="https://' + project.domain + '" target="_blank" class="text-decoration-none">' + 
                project.domain + ' <i class="fas fa-external-link-alt fa-xs"></i></a>';
            
            // Update live preview
            updateLivePreview(projectId);
            
            // Load statistics
            loadStatistics();
            
            // Load file tree
            loadFileTree(project.files || {});
        });
    };
    
    function updateBreadcrumb() {
        const breadcrumbNav = document.getElementById('breadcrumbNav');
        const ol = breadcrumbNav.querySelector('.breadcrumb');
        ol.innerHTML = '';
        
        // Add root
        const rootLi = document.createElement('li');
        rootLi.className = 'breadcrumb-item';
        rootLi.innerHTML = '<a href="#" onclick="goToRoot()"><i class="fas fa-home"></i> Root</a>';
        ol.appendChild(rootLi);
        
        // Add path segments
        if (currentPath !== '/') {
            const segments = currentPath.split('/').filter(s => s);
            let accumulatedPath = '';
            
            segments.forEach((segment, index) => {
                accumulatedPath += segment + '/';
                
                const li = document.createElement('li');
                li.className = 'breadcrumb-item';
                
                if (index === segments.length - 1) {
                    li.className += ' active';
                    li.setAttribute('aria-current', 'page');
                    li.textContent = segment;
                } else {
                    li.innerHTML = `<a href="#" onclick="navigateToPath('${accumulatedPath}')">${segment}</a>`;
                }
                
                ol.appendChild(li);
            });
        }
        
        // Update current path display
        document.getElementById('currentPathDisplay').textContent = currentPath;
        document.getElementById('uploadPath').value = currentPath;
        document.getElementById('folderPath').value = currentPath;
        document.getElementById('currentPathPreview').textContent = currentPath;
    }
    
    window.goToRoot = function() {
        currentPath = '/';
        updateBreadcrumb();
        refreshFileList();
    };
    
    window.navigateToPath = function(path) {
        currentPath = path;
        updateBreadcrumb();
        refreshFileList();
    };
    
    function loadFileTree(files) {
        const fileTree = document.getElementById('fileTree');
        fileTree.innerHTML = '';
        
        const tree = {};
        
        // Build tree structure
        Object.keys(files).forEach(key => {
            const path = key.replace(/___/g, '/');
            const parts = path.split('/');
            let current = tree;
            
            parts.forEach((part, index) => {
                if (!current[part]) {
                    current[part] = {};
                }
                if (index === parts.length - 1) {
                    current[part].__file__ = files[key];
                }
                current = current[part];
            });
        });
        
        // Filter for current path
        const currentTree = getTreeAtPath(tree, currentPath);
        
        // Render tree
        renderTreeItem(currentTree, '', fileTree, 0);
    }
    
    function getTreeAtPath(tree, path) {
        if (path === '/') return tree;
        
        const parts = path.split('/').filter(p => p);
        let current = tree;
        
        for (const part of parts) {
            if (current[part]) {
                current = current[part];
            } else {
                return {};
            }
        }
        
        return current;
    }
    
    function getFileIcon(fileType) {
        if (fileType.includes('image')) {
            return '<i class="fas fa-file-image text-success"></i>';
        } else if (fileType.includes('pdf')) {
            return '<i class="fas fa-file-pdf text-danger"></i>';
        } else if (fileType.includes('zip') || fileType.includes('compressed')) {
            return '<i class="fas fa-file-archive text-warning"></i>';
        } else if (fileType.includes('javascript') || fileType.includes('js')) {
            return '<i class="fas fa-file-code text-warning"></i>';
        } else if (fileType.includes('css')) {
            return '<i class="fas fa-file-code text-primary"></i>';
        } else if (fileType.includes('html')) {
            return '<i class="fas fa-file-code text-danger"></i>';
        } else {
            return '<i class="fas fa-file text-secondary"></i>';
        }
    }
    
    function renderTreeItem(tree, name, container, level) {
        const items = Object.keys(tree).filter(key => key !== '__file__');
        
        if (items.length === 0) {
            const emptyMsg = document.createElement('div');
            emptyMsg.className = 'text-center text-muted py-3';
            emptyMsg.innerHTML = '<i class="fas fa-folder-open fa-2x mb-2"></i><br>Folder kosong';
            container.appendChild(emptyMsg);
            return;
        }
        
        // Sort: folders first, then files
        items.sort((a, b) => {
            const aIsFolder = Object.keys(tree[a]).length > (tree[a].__file__ ? 1 : 0);
            const bIsFolder = Object.keys(tree[b]).length > (tree[b].__file__ ? 1 : 0);
            
            if (aIsFolder && !bIsFolder) return -1;
            if (!aIsFolder && bIsFolder) return 1;
            return a.localeCompare(b);
        });
        
        items.forEach(key => {
            const item = document.createElement('div');
            item.className = 'file-item';
            item.style.paddingLeft = (level * 20) + 'px';
            
            const isFolder = Object.keys(tree[key]).length > (tree[key].__file__ ? 1 : 0);
            const fullPath = name ? `${name}/${key}` : key;
            
            if (isFolder) {
                item.innerHTML = `
                    <div class="d-flex align-items-center justify-content-between">
                        <div class="d-flex align-items-center" style="flex-grow: 1; cursor: pointer;" onclick="openFolder('${fullPath}')">
                            <div class="file-icon">
                                <i class="fas fa-folder text-warning"></i>
                            </div>
                            <div>
                                <div class="fw-bold">${key}</div>
                                <small class="text-muted">Folder</small>
                            </div>
                        </div>
                        <div class="btn-group btn-group-sm file-actions">
                            <button class="btn btn-outline-primary" onclick="openFolder('${fullPath}')">
                                <i class="fas fa-folder-open"></i>
                            </button>
                            <button class="btn btn-outline-danger" onclick="showDeleteModal('${key}', '${currentPath}${fullPath}/', true)">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
                
                const subContainer = document.createElement('div');
                subContainer.className = 'file-tree-sub';
                item.appendChild(subContainer);
                
                renderTreeItem(tree[key], fullPath, subContainer, level + 1);
            } else {
                const file = tree[key].__file__;
                const cloudinaryBadge = file.isCloudinary ? '<span class="cloudinary-badge">CDN</span>' : '';
                
                item.innerHTML = `
                    <div class="d-flex align-items-center justify-content-between">
                        <div class="d-flex align-items-center" style="cursor: pointer; flex-grow: 1;" onclick="openFileFromTree('${fullPath}')">
                            <div class="file-icon">
                                ${getFileIcon(file.type || 'file')}
                            </div>
                            <div>
                                <div class="fw-bold">${key} ${cloudinaryBadge}</div>
                                <small class="text-muted">${formatBytes(file.size || 0)} ‚Ä¢ ${file.type || 'file'}</small>
                            </div>
                        </div>
                        <div class="btn-group btn-group-sm file-actions">
                            <button class="btn btn-outline-primary" onclick="downloadFile('${key}', '${currentPath}${fullPath}')">
                                <i class="fas fa-download"></i>
                            </button>
                            <button class="btn btn-outline-danger" onclick="showDeleteModal('${key}', '${currentPath}', false)">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            }
            
            container.appendChild(item);
        });
    }
    
    window.openFolder = function(folderPath) {
        currentPath = currentPath + folderPath + '/';
        updateBreadcrumb();
        refreshFileList();
    };
    
    window.openFileFromTree = async function(path) {
        // Check if it's an image or binary file
        const escapedPath = path.replace(/\//g, '___');
        const projectRef = db.collection('projects').doc(currentProject);
        const projectDoc = await projectRef.get();
        const project = projectDoc.data();
        const fileData = project.files[escapedPath];
        
        if (!fileData) {
            alert('File tidak ditemukan');
            return;
        }
        
        // If it's an image or binary file, show preview
        if (fileData.isCloudinary && fileData.cloudinaryUrl && 
            (fileData.type.includes('image') || path.match(/\.(jpg|jpeg|png|gif|webp|pdf)$/i))) {
            // Show image preview
            const previewWindow = window.open(fileData.cloudinaryUrl, '_blank');
            if (!previewWindow) {
                alert('Popup blocker mungkin mencegah preview. Silakan izinkan popup untuk situs ini.');
            }
            return;
        }
        
        // Otherwise, open in editor
        editFile(path.split('/').pop());
    };
    
    window.showUploadModal = function() {
        document.getElementById('fileInput').value = '';
        document.getElementById('uploadPath').value = currentPath;
        document.getElementById('fileList').innerHTML = '';
        document.getElementById('currentPathPreview').textContent = currentPath;
        new bootstrap.Modal(document.getElementById('uploadModal')).show();
    };
    
    function showFileList(files) {
        const fileList = document.getElementById('fileList');
        fileList.innerHTML = '';
        
        Array.from(files).forEach((file, index) => {
            const div = document.createElement('div');
            div.className = 'd-flex align-items-center mb-2';
            div.innerHTML = `
                <div class="file-icon me-2">
                    ${getFileIcon(file.type || 'file')}
                </div>
                <div class="flex-grow-1">
                    <div class="fw-bold">${file.name}</div>
                    <small class="text-muted">${formatBytes(file.size)} ‚Ä¢ ${file.type || 'Unknown'}</small>
                </div>
                <button class="btn btn-sm btn-outline-danger" onclick="removeFileFromList(${index})">
                    <i class="fas fa-times"></i>
                </button>
            `;
            fileList.appendChild(div);
        });
    }
    
    window.removeFileFromList = function(index) {
        const fileInput = document.getElementById('fileInput');
        const dt = new DataTransfer();
        const files = fileInput.files;
        
        for (let i = 0; i < files.length; i++) {
            if (i !== index) {
                dt.items.add(files[i]);
            }
        }
        
        fileInput.files = dt.files;
        showFileList(fileInput.files);
    };
    
    window.startUpload = async function() {
        const files = document.getElementById('fileInput').files;
        const uploadPath = document.getElementById('uploadPath').value || '/';
        
        if (files.length === 0) {
            alert('Pilih file terlebih dahulu!');
            return;
        }
        
        // Show upload progress
        const uploadModal = bootstrap.Modal.getInstance(document.getElementById('uploadModal'));
        uploadModal.hide();
        
        document.getElementById('uploadProgress').classList.remove('d-none');
        
        let uploadedCount = 0;
        const totalFiles = files.length;
        
        for (let i = 0; i < files.length; i++) {
            const file = files[i];
            
            // Update progress UI
            document.getElementById('uploadFileName').textContent = file.name;
            const percent = Math.round(((i + 1) / totalFiles) * 100);
            document.getElementById('uploadPercent').textContent = percent + '%';
            document.getElementById('uploadProgressBar').style.width = percent + '%';
            document.getElementById('uploadStatus').textContent = `Uploading ${i + 1} of ${totalFiles}...`;
            
            try {
                await uploadSingleFile(file, uploadPath);
                uploadedCount++;
                
                // Small delay for better UX
                await new Promise(resolve => setTimeout(resolve, 300));
                
            } catch (error) {
                console.error('Upload error:', error);
                document.getElementById('uploadStatus').innerHTML = `<span class="text-danger">Error uploading ${file.name}: ${error.message}</span>`;
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
        }
        
        // Complete
        document.getElementById('uploadStatus').innerHTML = `<span class="text-success">‚úÖ ${uploadedCount} file berhasil diupload!</span>`;
        
        // Hide progress after 3 seconds
        setTimeout(() => {
            document.getElementById('uploadProgress').classList.add('d-none');
            
            // Refresh file list
            if (currentProject) {
                db.collection('projects').doc(currentProject).get().then(doc => {
                    const project = doc.data();
                    loadFileTree(project.files || {});
                    refreshStatistics();
                    updateLivePreview(currentProject);
                });
            }
        }, 3000);
    };
    
    async function uploadSingleFile(file, path) {
        return new Promise((resolve, reject) => {
            // Validate file size (20MB limit)
            if (file.size > 20 * 1024 * 1024) {
                reject(new Error('File size exceeds 20MB limit'));
                return;
            }

            const reader = new FileReader();
            
            reader.onload = async function(e) {
                try {
                    document.getElementById('uploadStatus').textContent = `Uploading to Cloudinary...`;
                    
                    // Upload ke Cloudinary
                    const result = await cloudinaryUpload(file, path);
                    
                    // Simpan metadata ke Firestore
                    await saveFileMetadata(file, result, path);
                    
                    resolve(result);
                    
                } catch (error) {
                    reject(error);
                }
            };
            
            reader.onerror = function() {
                reject(new Error('Failed to read file'));
            };
            
            reader.readAsDataURL(file);
        });
    }
    
    async function cloudinaryUpload(file, path) {
        return new Promise((resolve, reject) => {
            const formData = new FormData();
            formData.append('file', file);
            formData.append('upload_preset', cloudinaryConfig.uploadPreset);
            formData.append('cloud_name', cloudinaryConfig.cloudName);
            formData.append('folder', `pgxl/${currentProject}${path}`);
            
            fetch(`https://api.cloudinary.com/v1_1/${cloudinaryConfig.cloudName}/auto/upload`, {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    reject(new Error(data.error.message));
                } else {
                    resolve(data);
                }
            })
            .catch(error => reject(error));
        });
    }
    
    async function saveFileMetadata(file, cloudinaryResult, path) {
        let cleanPath = path;
        if (!cleanPath.startsWith('/')) cleanPath = '/' + cleanPath;
        if (!cleanPath.endsWith('/') && cleanPath !== '/') cleanPath = cleanPath + '/';
        
        const filePath = cleanPath + file.name;
        const escapedPath = filePath.replace(/\//g, '___');
        
        const fileData = {
            name: file.name,
            type: file.type || file.name.split('.').pop().toLowerCase(),
            size: file.size,
            cloudinaryUrl: cloudinaryResult.secure_url,
            cloudinaryId: cloudinaryResult.public_id,
            cloudinaryFormat: cloudinaryResult.format,
            isCloudinary: true,
            path: cleanPath,
            updated: firebase.firestore.FieldValue.serverTimestamp(),
            created: firebase.firestore.FieldValue.serverTimestamp()
        };
        
        const updateData = {};
        updateData['files.' + escapedPath] = fileData;
        
        // Update stats
        const projectRef = db.collection('projects').doc(currentProject);
        const projectDoc = await projectRef.get();
        const project = projectDoc.data();
        const stats = project.stats || { files: 0, storage: 0 };
        
        updateData['stats.files'] = (stats.files || 0) + 1;
        updateData['stats.storage'] = (stats.storage || 0) + file.size;
        updateData['stats.lastUpdated'] = firebase.firestore.FieldValue.serverTimestamp();
        
        await projectRef.update(updateData);
    }
    
    function updateLivePreview(projectId) {
        const iframe = document.getElementById('livePreviewFrame');
        iframe.src = `https://${projectId}.pgxl.web.id?preview=${Date.now()}`;
    }
    
    window.refreshPreview = function() {
        if (currentProject) {
            updateLivePreview(currentProject);
        }
    };
    
    async function loadStatistics() {
        if (!currentProject) return;
        
        try {
            const doc = await db.collection('projects').doc(currentProject).get();
            const project = doc.data();
            const stats = project.stats || {};
            const traffic = project.traffic || {};
            
            // Update basic stats
            document.getElementById('statViews').textContent = stats.views || 0;
            document.getElementById('statVisitors').textContent = stats.visitors || 0;
            document.getElementById('statFiles').textContent = stats.files || 0;
            document.getElementById('statStorage').textContent = formatBytes(stats.storage || 0);
            
            // Prepare traffic data for chart
            const period = document.getElementById('statsPeriod').value;
            const now = new Date();
            const labels = [];
            const viewsData = [];
            const visitorsData = [];
            
            let daysToShow = 7;
            if (period === 'today') daysToShow = 1;
            if (period === 'month') daysToShow = 30;
            
            for (let i = daysToShow - 1; i >= 0; i--) {
                const date = new Date(now);
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                
                labels.push(dateStr.substring(5)); // Format: MM-DD
                const dayData = traffic[dateStr] || { views: 0, visitors: 0 };
                viewsData.push(dayData.views || 0);
                visitorsData.push(dayData.visitors || 0);
            }
            
            // Create or update chart
            const ctx = document.getElementById('trafficChart').getContext('2d');
            
            if (trafficChart) {
                trafficChart.data.labels = labels;
                trafficChart.data.datasets[0].data = viewsData;
                trafficChart.data.datasets[1].data = visitorsData;
                trafficChart.update();
            } else {
                trafficChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Views',
                                data: viewsData,
                                borderColor: '#667eea',
                                backgroundColor: 'rgba(102, 126, 234, 0.1)',
                                tension: 0.4,
                                fill: true
                            },
                            {
                                label: 'Visitors',
                                data: visitorsData,
                                borderColor: '#10b981',
                                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                tension: 0.4,
                                fill: true
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top',
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    stepSize: 1
                                }
                            }
                        }
                    }
                });
            }
            
        } catch (error) {
            console.error('Error loading statistics:', error);
        }
    }
    
    window.refreshStatistics = function() {
        loadStatistics();
    };
    
    window.refreshFileList = function() {
        if (currentProject) {
            db.collection('projects').doc(currentProject).get().then(doc => {
                const project = doc.data();
                loadFileTree(project.files || {});
            });
        }
    };
    
    window.showNewFolderModal = function() {
        document.getElementById('folderName').value = '';
        document.getElementById('folderPath').value = currentPath;
        new bootstrap.Modal(document.getElementById('newFolderModal')).show();
    };
    
    window.createNewFolder = async function() {
        const folderName = document.getElementById('folderName').value.trim();
        
        if (!folderName) {
            alert('Nama folder harus diisi!');
            return;
        }
        
        // Create folder by creating a placeholder file
        const folderPath = currentPath + folderName + '/';
        const placeholderPath = folderPath + '.placeholder';
        const escapedPath = placeholderPath.replace(/\//g, '___');
        
        const fileData = {
            name: '.placeholder',
            type: 'txt',
            size: 0,
            content: 'Folder placeholder',
            isFolder: true,
            updated: firebase.firestore.FieldValue.serverTimestamp(),
            created: firebase.firestore.FieldValue.serverTimestamp()
        };
        
        const updateData = {};
        updateData['files.' + escapedPath] = fileData;
        
        try {
            await db.collection('projects').doc(currentProject).update(updateData);
            bootstrap.Modal.getInstance(document.getElementById('newFolderModal')).hide();
            alert('‚úÖ Folder berhasil dibuat!');
            refreshFileList();
        } catch (error) {
            console.error('Error creating folder:', error);
            alert('‚ùå Gagal membuat folder: ' + error.message);
        }
    };
    
    window.editFile = function(fileName) {
        const filePath = currentPath + fileName;
        const escapedPath = filePath.replace(/\//g, '___');
        
        db.collection('projects').doc(currentProject).get().then(doc => {
            const project = doc.data();
            const fileData = project.files[escapedPath];
            
            if (fileData) {
                // Check if it's a Cloudinary/binary file
                if (fileData.isCloudinary) {
                    alert('File Cloudinary tidak dapat diedit di editor teks. Silakan download dan upload ulang.');
                    return;
                }
                
                document.getElementById('editorFileName').textContent = fileName;
                document.getElementById('fileManager').classList.add('d-none');
                document.getElementById('editorSection').classList.remove('d-none');
                
                // Initialize editor if not already
                if (!editor) {
                    editor = ace.edit("codeEditor");
                    editor.setTheme("ace/theme/chrome");
                    editor.session.setMode("ace/mode/html");
                    editor.setOptions({
                        fontSize: "14px",
                        showPrintMargin: false,
                        enableBasicAutocompletion: true,
                        enableLiveAutocompletion: true,
                        showLineNumbers: true,
                        showGutter: true,
                        highlightActiveLine: true,
                        tabSize: 2,
                        useSoftTabs: true
                    });
                }
                
                // Set mode based on file extension
                const ext = fileName.split('.').pop().toLowerCase();
                if (ext === 'html') editor.session.setMode("ace/mode/html");
                else if (ext === 'css') editor.session.setMode("ace/mode/css");
                else if (ext === 'js') editor.session.setMode("ace/mode/javascript");
                else if (ext === 'json') editor.session.setMode("ace/mode/json");
                else editor.session.setMode("ace/mode/text");
                
                editor.setValue(fileData.content || '', -1);
                originalContent = fileData.content || '';
                editor.focus();
                
                // Show save reminder
                editor.commands.addCommand({
                    name: 'saveFile',
                    bindKey: {win: 'Ctrl-S', mac: 'Command-S'},
                    exec: function(editor) {
                        saveFile();
                    }
                });
            }
        }).catch(error => {
            console.error('Error loading file for edit:', error);
            alert('Error loading file: ' + error.message);
        });
    };
    
    window.saveFile = async function() {
        const fileName = document.getElementById('editorFileName').textContent;
        const content = editor.getValue();
        const filePath = currentPath + fileName;
        const escapedPath = filePath.replace(/\//g, '___');
        
        try {
            const updateData = {};
            updateData['files.' + escapedPath] = {
                content: content,
                updated: firebase.firestore.FieldValue.serverTimestamp(),
                type: fileName.split('.').pop().toLowerCase(),
                size: content.length,
                isCloudinary: false
            };
            
            await db.collection('projects').doc(currentProject).update(updateData);
            
            alert('‚úÖ File berhasil disimpan!');
            originalContent = content;
            
            // Update file tree
            db.collection('projects').doc(currentProject).get().then(doc => {
                const project = doc.data();
                loadFileTree(project.files || {});
                refreshStatistics();
                updateLivePreview(currentProject);
            });
            
        } catch (error) {
            console.error('Error saving file:', error);
            alert('‚ùå Gagal menyimpan file: ' + error.message);
        }
    };
    
    window.closeEditor = function() {
        if (editor && editor.getValue() !== originalContent) {
            if (confirm('Anda memiliki perubahan yang belum disimpan. Tutup tanpa menyimpan?')) {
                document.getElementById('editorSection').classList.add('d-none');
                document.getElementById('fileManager').classList.remove('d-none');
            }
        } else {
            document.getElementById('editorSection').classList.add('d-none');
            document.getElementById('fileManager').classList.remove('d-none');
        }
    };
    
    window.showDeleteModal = function(itemName, itemPath, isFolder = false) {
        itemToDelete = {
            name: itemName,
            path: itemPath,
            isFolder: isFolder
        };
        
        document.getElementById('deleteItemName').textContent = itemName;
        document.getElementById('deleteItemType').textContent = 
            isFolder ? 'Folder dan semua isinya akan dihapus' : 'File ini akan dihapus';
        
        // Reset checkbox
        document.getElementById('confirmFileDelete').checked = false;
        document.getElementById('deleteFileConfirmBtn').disabled = true;
        
        // Add event listener for checkbox
        document.getElementById('confirmFileDelete').onchange = function() {
            document.getElementById('deleteFileConfirmBtn').disabled = !this.checked;
        };
        
        new bootstrap.Modal(document.getElementById('deleteFileModal')).show();
    };
    
    window.confirmDeleteItem = async function() {
        if (!itemToDelete) return;
        
        try {
            const { name, path, isFolder } = itemToDelete;
            
            if (isFolder) {
                await deleteFolder(path);
            } else {
                await deleteFile(name, path);
            }
            
            bootstrap.Modal.getInstance(document.getElementById('deleteFileModal')).hide();
            alert('‚úÖ Item berhasil dihapus!');
            refreshFileList();
            refreshStatistics();
            
        } catch (error) {
            console.error('Error deleting item:', error);
            alert('‚ùå Gagal menghapus: ' + error.message);
        }
    };
    
    async function deleteFile(fileName, path) {
        const filePath = path + fileName;
        const escapedPath = filePath.replace(/\//g, '___');
        
        // Get file metadata
        const projectRef = db.collection('projects').doc(currentProject);
        const projectDoc = await projectRef.get();
        const project = projectDoc.data();
        const fileData = project.files[escapedPath];
        
        if (!fileData) {
            throw new Error('File not found');
        }
        
        // If it's a Cloudinary file, delete from Cloudinary too
        if (fileData.isCloudinary && fileData.cloudinaryId) {
            try {
                await deleteFromCloudinary(fileData.cloudinaryId);
            } catch (cloudinaryError) {
                console.warn('Failed to delete from Cloudinary:', cloudinaryError);
                // Continue with Firestore deletion even if Cloudinary fails
            }
        }
        
        // Delete from Firestore
        const updateData = {};
        updateData['files.' + escapedPath] = firebase.firestore.FieldValue.delete();
        
        // Update stats
        const stats = project.stats || { files: 0, storage: 0 };
        updateData['stats.files'] = Math.max(0, (stats.files || 1) - 1);
        updateData['stats.storage'] = Math.max(0, (stats.storage || 0) - (fileData.size || 0));
        updateData['stats.lastUpdated'] = firebase.firestore.FieldValue.serverTimestamp();
        
        await projectRef.update(updateData);
    }
    
    async function deleteFolder(folderPath) {
        const projectRef = db.collection('projects').doc(currentProject);
        const projectDoc = await projectRef.get();
        const project = projectDoc.data();
        const files = project.files || {};
        
        let totalFiles = 0;
        let totalSize = 0;
        
        // Find all files in this folder
        const filesToDelete = [];
        
        Object.keys(files).forEach(escapedPath => {
            const actualPath = escapedPath.replace(/___/g, '/');
            if (actualPath.startsWith(folderPath)) {
                filesToDelete.push({
                    escapedPath,
                    data: files[escapedPath]
                });
                totalFiles++;
                totalSize += files[escapedPath].size || 0;
            }
        });
        
        if (filesToDelete.length === 0) {
            throw new Error('Folder is empty or not found');
        }
        
        // Delete from Cloudinary first
        const cloudinaryDeletes = filesToDelete.map(async (file) => {
            if (file.data.isCloudinary && file.data.cloudinaryId) {
                try {
                    await deleteFromCloudinary(file.data.cloudinaryId);
                } catch (error) {
                    console.warn('Failed to delete from Cloudinary:', error);
                }
            }
        });
        
        await Promise.all(cloudinaryDeletes);
        
        // Delete from Firestore
        const batch = db.batch();
        
        filesToDelete.forEach(file => {
            batch.update(projectRef, {
                [`files.${file.escapedPath}`]: firebase.firestore.FieldValue.delete()
            });
        });
        
        // Update stats
        const stats = project.stats || { files: 0, storage: 0 };
        batch.update(projectRef, {
            'stats.files': Math.max(0, (stats.files || 0) - totalFiles),
            'stats.storage': Math.max(0, (stats.storage || 0) - totalSize),
            'stats.lastUpdated': firebase.firestore.FieldValue.serverTimestamp()
        });
        
        await batch.commit();
    }
    
    async function deleteFromCloudinary(publicId) {
        // Note: In production, this should be done server-side
        // For demo purposes, we'll just log it
        console.log('Would delete from Cloudinary:', publicId);
        
        // Actually, let's implement a simple version
        const timestamp = Math.round(new Date().getTime() / 1000);
        const stringToSign = `public_id=${publicId}&timestamp=${timestamp}${cloudinaryConfig.apiSecret}`;
        
        // Simple hash function (in production use proper crypto)
        let hash = 0;
        for (let i = 0; i < stringToSign.length; i++) {
            const char = stringToSign.charCodeAt(i);
            hash = ((hash << 5) - hash) + char;
            hash = hash & hash;
        }
        const signature = Math.abs(hash).toString(16);
        
        const formData = new FormData();
        formData.append('public_id', publicId);
        formData.append('timestamp', timestamp);
        formData.append('api_key', cloudinaryConfig.apiKey);
        formData.append('signature', signature);
        
        return fetch(`https://api.cloudinary.com/v1_1/${cloudinaryConfig.cloudName}/image/destroy`, {
            method: 'POST',
            body: formData
        }).then(response => response.json());
    }
    
    window.downloadFile = async function(fileName, filePath) {
        try {
            const escapedPath = filePath.replace(/\//g, '___');
            const projectRef = db.collection('projects').doc(currentProject);
            const projectDoc = await projectRef.get();
            const project = projectDoc.data();
            const fileData = project.files[escapedPath];
            
            if (!fileData) {
                alert('File not found');
                return;
            }
            
            let url;
            if (fileData.isCloudinary && fileData.cloudinaryUrl) {
                url = fileData.cloudinaryUrl;
            } else if (fileData.content) {
                // Create blob from content
                const blob = new Blob([fileData.content], { type: fileData.type });
                url = URL.createObjectURL(blob);
            } else {
                alert('Cannot download this file');
                return;
            }
            
            // Create download link
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            if (!fileData.isCloudinary) {
                URL.revokeObjectURL(url);
            }
            
        } catch (error) {
            console.error('Error downloading file:', error);
            alert('Download failed: ' + error.message);
        }
    };
    
    window.showDeleteProjectModal = function() {
        new bootstrap.Modal(document.getElementById('deleteProjectModal')).show();
    };
    
    window.deleteCurrentProject = async function() {
        try {
            // First, delete all Cloudinary files
            const projectRef = db.collection('projects').doc(currentProject);
            const projectDoc = await projectRef.get();
            const project = projectDoc.data();
            const files = project.files || {};
            
            // Delete Cloudinary files
            const cloudinaryDeletes = Object.keys(files).map(async (escapedPath) => {
                const fileData = files[escapedPath];
                if (fileData.isCloudinary && fileData.cloudinaryId) {
                    try {
                        await deleteFromCloudinary(fileData.cloudinaryId);
                    } catch (error) {
                        console.warn('Failed to delete from Cloudinary:', error);
                    }
                }
            });
            
            await Promise.all(cloudinaryDeletes);
            
            // Delete from Firestore
            await projectRef.delete();
            
            alert('‚úÖ Website berhasil dihapus!');
            bootstrap.Modal.getInstance(document.getElementById('deleteProjectModal')).hide();
            window.loadProjects();
            goToDashboard();
        } catch (error) {
            console.error('Error deleting project:', error);
            alert('‚ùå Gagal menghapus website: ' + error.message);
        }
    };
    
    window.goToDashboard = function() {
        document.getElementById('fileManager').classList.add('d-none');
        document.getElementById('editorSection').classList.add('d-none');
        document.getElementById('notFoundPage').classList.add('d-none');
        document.getElementById('welcomeDashboard').classList.remove('d-none');
        currentProject = null;
        currentPath = '/';
    };
    
    window.refreshPage = function() {
        location.reload();
    };
    
    window.showLegal = function(type) {
        document.getElementById('welcomeSection').classList.add('d-none');
        document.getElementById('dashboard').classList.add('d-none');
        document.getElementById('legalSection').classList.remove('d-none');
        
        if (type === 'tos') {
            window.scrollTo(0, 0);
        } else if (type === 'privacy') {
            const privacySection = document.querySelector('#legalSection .card:last-child');
            privacySection.scrollIntoView();
        }
    };
    
    window.goBack = function() {
        document.getElementById('legalSection').classList.add('d-none');
        if (currentUser) {
            document.getElementById('dashboard').classList.remove('d-none');
        } else {
            document.getElementById('welcomeSection').classList.remove('d-none');
        }
    };
    
    function formatBytes(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }
    
    function showWelcome() {
        document.getElementById('welcomeSection').classList.remove('d-none');
        document.getElementById('dashboard').classList.add('d-none');
        document.getElementById('authButtons').innerHTML = 
            '<button class="btn btn-outline-primary" onclick="showAuthModal()">' +
                '<i class="fas fa-sign-in-alt me-1"></i> Login' +
            '</button>';
    }
    
    function showDashboard() {
        document.getElementById('welcomeSection').classList.add('d-none');
        document.getElementById('dashboard').classList.remove('d-none');
        document.getElementById('userEmail').textContent = currentUser.email;
        document.getElementById('authButtons').innerHTML = 
            '<div class="d-flex align-items-center">' +
                '<span class="me-3 text-muted d-none d-md-block">' + currentUser.email + '</span>' +
                '<button class="btn btn-outline-danger btn-sm" onclick="logout()">' +
                    '<i class="fas fa-sign-out-alt"></i>' +
                '</button>' +
            '</div>';
        window.loadProjects();
    }
    
    // Error handling
    window.addEventListener('error', function(e) {
        console.error('Global error:', e.error);
    });
    
    // Initialize
    console.log('üöÄ PGXL.WEB.ID v2.1 loaded successfully!');
    console.log('Original hostname:', ORIGINAL_HOSTNAME);
    console.log('Cloudinary configured for:', cloudinaryConfig.cloudName);
    </script>
</body>
</html>
