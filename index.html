<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PGXL | Financial Mastery Game</title>
    <style>
        /* [CSS sama seperti sebelumnya] */
    </style>
</head>
<body>
    <!-- HEADER -->
    <header class="header">
        <div class="container header-content">
            <div class="logo">
                <span class="logo-icon">PGXL</span>
                <span>Financial Mastery</span>
            </div>
            <div class="nav-controls" id="nav-controls">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>
    </header>
    
    <!-- MAIN CONTENT -->
    <main class="main">
        <div class="container" id="main-content">
            <!-- Content will be loaded dynamically -->
        </div>
    </main>
    
    <!-- MODALS -->
    <div class="modal-overlay" id="login-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Masuk ke PGXL</h2>
                <button class="modal-close" onclick="closeModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <input type="text" id="player-name" placeholder="Masukkan nama Anda" style="width: 100%; padding: 12px; margin-bottom: 16px; border-radius: 6px; border: 1px solid var(--border-color); background: var(--bg-tertiary); color: var(--text-primary);">
                <button class="btn btn-primary" onclick="loginWithName()" style="width: 100%; padding: 12px;">
                    ðŸŽ® Mulai Game
                </button>
                <p style="margin-top: 16px; color: var(--text-secondary); text-align: center;">
                    Progress akan disimpan di browser Anda
                </p>
            </div>
        </div>
    </div>
    
    <!-- [Stage Modal dan Certificate Modal sama seperti sebelumnya] -->
    
    <script>
        // ==================== SIMPLE AUTH SYSTEM ====================
        let currentUser = null;
        let userData = null;
        
        function checkAuth() {
            const savedUser = localStorage.getItem('pgxl_user');
            if (savedUser) {
                userData = JSON.parse(savedUser);
                currentUser = { displayName: userData.displayName };
                renderDashboard();
            } else {
                showLoginModal();
            }
        }
        
        function showLoginModal() {
            document.getElementById('login-modal').style.display = 'flex';
            document.getElementById('main-content').innerHTML = `
                <div class="landing">
                    <h1>ðŸŽ® PGXL Financial Mastery</h1>
                    <p class="landing-subtitle">Kuasa keuangan dalam 50 tahap</p>
                    <button class="btn btn-primary" onclick="document.getElementById('login-modal').style.display='flex'">
                        Mulai Game
                    </button>
                </div>
            `;
            
            document.getElementById('nav-controls').innerHTML = `
                <button class="btn" onclick="document.getElementById('login-modal').style.display='flex'">
                    Login
                </button>
            `;
        }
        
        function loginWithName() {
            const nameInput = document.getElementById('player-name');
            const playerName = nameInput.value.trim();
            
            if (!playerName) {
                alert("Masukkan nama terlebih dahulu!");
                return;
            }
            
            // Create user data
            userData = {
                uid: 'user_' + Date.now(),
                displayName: playerName,
                photoURL: `https://ui-avatars.com/api/?name=${encodeURIComponent(playerName)}&background=random`,
                createdAt: new Date().toISOString(),
                totalXP: 0,
                level: 1,
                completedStages: {},
                currentStage: "1_1"
            };
            
            // Save to localStorage
            localStorage.setItem('pgxl_user', JSON.stringify(userData));
            currentUser = { displayName: playerName };
            
            closeModal();
            renderDashboard();
        }
        
        function logout() {
            if (confirm("Yakin ingin logout? Progress akan tetap tersimpan.")) {
                localStorage.removeItem('pgxl_user');
                currentUser = null;
                userData = null;
                showLoginModal();
            }
        }
        
        function saveProgress() {
            if (userData) {
                localStorage.setItem('pgxl_user', JSON.stringify(userData));
            }
        }
        
        // ==================== GAME DATA ====================
        const gameData = {
            totalLevels: 5,
            stagesPerLevel: 10,
            totalStages: 50,
            
            levelTitles: {
                1: "Dasar-dasar Keuangan",
                2: "Anggaran & Tabungan", 
                3: "Investasi Pemula",
                4: "Manajemen Utang",
                5: "Perencanaan Masa Depan"
            },
            
            stages: {
                "1_1": {
                    title: "Pengenalan Pengelolaan Uang",
                    content: `<h3>ðŸ’° Apa itu Pengelolaan Uang?</h3>
                    <p>Pengelolaan uang adalah seni dan ilmu dalam merencanakan, mengatur, dan mengendalikan penggunaan uang untuk mencapai tujuan keuangan.</p>`,
                    question: "Apa langkah pertama dalam pengelolaan uang yang baik?",
                    options: [
                        "Membeli saham mahal",
                        "Mencatat semua pemasukan dan pengeluaran",
                        "Mengajukan kartu kredit",
                        "Menabung tanpa tujuan"
                    ],
                    correctAnswer: 1,
                    clue: "Anda tidak bisa mengelola apa yang tidak Anda ukur.",
                    xpReward: 10
                },
                // ... tambahkan semua 50 stage
                "5_10": {
                    title: "Ujian Akhir Financial Mastery",
                    content: `<h3>ðŸŽ“ FINAL TEST</h3>
                    <p>Selamat! Anda telah sampai di tahap terakhir.</p>`,
                    question: "Apa strategi terbaik untuk mencapai kebebasan finansial?",
                    options: [
                        "Menabung saja tanpa investasi",
                        "Investasi konsisten + penghasilan pasif + pengelolaan risiko",
                        "Bergantung pada warisan orang tua",
                        "Beli lotre setiap minggu"
                    ],
                    correctAnswer: 1,
                    clue: "Konsistensi, passive income, dan manajemen risiko.",
                    xpReward: 50
                }
            }
        };
        
        // ==================== GAME FUNCTIONS ====================
        function renderDashboard() {
            if (!userData) return;
            
            const progress = calculateProgress();
            
            document.getElementById('main-content').innerHTML = `
                <div class="dashboard">
                    <h1>Selamat Datang, ${userData.displayName}!</h1>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value">${userData.level}</div>
                            <div>Level</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${userData.totalXP}</div>
                            <div>Total XP</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${progress.completed}</div>
                            <div>Tahap Selesai</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${progress.percentage}%</div>
                            <div>Progress</div>
                        </div>
                    </div>
                    
                    <h2>ðŸ“š Level & Tahap</h2>
                    <div class="levels-grid">
                        ${renderLevels()}
                    </div>
                </div>
            `;
            
            document.getElementById('nav-controls').innerHTML = `
                <div class="user-info">
                    <img src="${userData.photoURL}" alt="Avatar" class="avatar">
                    <span>${userData.displayName}</span>
                </div>
                <button class="btn btn-danger" onclick="logout()">Logout</button>
            `;
        }
        
        function renderLevels() {
            let html = '';
            for (let level = 1; level <= 5; level++) {
                html += `
                    <div class="level-card" onclick="openLevel(${level})">
                        <div class="level-number">Level ${level}</div>
                        <div class="level-title">${gameData.levelTitles[level]}</div>
                        <div class="level-progress">
                            ${renderStageDots(level)}
                        </div>
                    </div>
                `;
            }
            return html;
        }
        
        function renderStageDots(level) {
            let dots = '';
            for (let i = 1; i <= 10; i++) {
                const stageKey = `${level}_${i}`;
                const isCompleted = userData.completedStages && userData.completedStages[stageKey];
                dots += `<div class="progress-dot ${isCompleted ? 'completed' : ''}"></div>`;
            }
            return dots;
        }
        
        function openLevel(level) {
            openStage(`${level}_1`);
        }
        
        function openStage(stageKey) {
            const stageData = gameData.stages[stageKey];
            // ... [sama seperti sebelumnya]
        }
        
        function calculateProgress() {
            if (!userData || !userData.completedStages) {
                return { completed: 0, percentage: 0 };
            }
            const completed = Object.keys(userData.completedStages).length;
            const percentage = Math.round((completed / 50) * 100);
            return { completed, percentage };
        }
        
        function closeModal() {
            document.getElementById('login-modal').style.display = 'none';
            document.getElementById('stage-modal').style.display = 'none';
            document.getElementById('certificate-modal').style.display = 'none';
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', checkAuth);
        
        // Expose functions to global scope
        window.loginWithName = loginWithName;
        window.logout = logout;
        window.openLevel = openLevel;
        window.openStage = openStage;
        window.closeModal = closeModal;
    </script>
</body>
</html>
