<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PGXL.WEB.ID - Free Static Hosting</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: #ffffff;
            color: #333;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        }
        .card {
            border: 1px solid #eaeaea;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.1);
        }
        .navbar {
            background: #fff;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border-bottom: 1px solid #eaeaea;
        }
        .btn-primary {
            background: #667eea;
            border: none;
            border-radius: 8px;
            padding: 10px 24px;
            font-weight: 500;
        }
        .btn-primary:hover {
            background: #5a67d8;
        }
        .file-item:hover {
            background: #f8fafc;
        }
        .ads-footer {
            background: #f8fafc;
            border-top: 1px solid #eaeaea;
            padding: 20px 0;
            margin-top: 60px;
            color: #64748b;
        }
        .feature-icon {
            width: 48px;
            height: 48px;
            background: #667eea;
            color: white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 20px;
        }
        .project-domain {
            font-family: 'Courier New', monospace;
            background: #f1f5f9;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
        }
        .ace_editor {
            border-radius: 8px;
            border: 1px solid #eaeaea;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light">
        <div class="container">
            <a class="navbar-brand fw-bold text-primary" href="#">
                <i class="fas fa-server me-2"></i>PGXL.WEB.ID
            </a>
            <div id="authButtons"></div>
        </div>
    </nav>

    <div class="container py-5">
        <!-- Welcome Section -->
        <div class="row mb-5" id="welcomeSection">
            <div class="col-12 text-center">
                <h1 class="display-5 fw-bold mb-3">üöÄ Hosting Website Statis Gratis</h1>
                <p class="lead text-muted mb-4">Upload file HTML/CSS/JS dan dapatkan subdomain instan</p>
                
                <div class="project-domain d-inline-block mb-4">
                    namaproject<span class="text-primary">.pgxl.web.id</span>
                </div>
                
                <div class="d-flex gap-3 justify-content-center">
                    <button class="btn btn-primary btn-lg" onclick="showAuthModal()">
                        <i class="fas fa-rocket me-2"></i>Mulai Gratis
                    </button>
                    <a href="#features" class="btn btn-outline-secondary btn-lg">
                        <i class="fas fa-info-circle me-2"></i>Pelajari Fitur
                    </a>
                </div>
            </div>
        </div>

        <!-- Features -->
        <div class="row mb-5" id="features">
            <div class="col-md-4 mb-4">
                <div class="card h-100 border-0">
                    <div class="card-body text-center p-4">
                        <div class="feature-icon">
                            <i class="fas fa-bolt"></i>
                        </div>
                        <h5 class="fw-bold">Deploy Instan</h5>
                        <p class="text-muted">Upload file, langsung online. Tidak perlu config ribet.</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-4">
                <div class="card h-100 border-0">
                    <div class="card-body text-center p-4">
                        <div class="feature-icon">
                            <i class="fas fa-code"></i>
                        </div>
                        <h5 class="fw-bold">File Manager</h5>
                        <p class="text-muted">Edit file langsung di browser. Support HTML, CSS, JavaScript.</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4 mb-4">
                <div class="card h-100 border-0">
                    <div class="card-body text-center p-4">
                        <div class="feature-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <h5 class="fw-bold">100% Gratis</h5>
                        <p class="text-muted">Tidak ada biaya tersembunyi. Selamanya gratis untuk website statis.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dashboard (After Login) -->
        <div class="row d-none" id="dashboard">
            <!-- Sidebar -->
            <div class="col-md-3">
                <div class="card mb-4">
                    <div class="card-body">
                        <div class="d-flex align-items-center mb-3">
                            <i class="fas fa-user-circle fa-2x text-muted me-3"></i>
                            <div>
                                <h6 class="mb-0 fw-bold" id="userEmail"></h6>
                                <small class="text-muted">Free Plan</small>
                            </div>
                        </div>
                        <button class="btn btn-primary w-100 mb-2" onclick="showAddProjectModal()">
                            <i class="fas fa-plus me-2"></i>Website Baru
                        </button>
                        <button class="btn btn-outline-danger w-100" onclick="logout()">
                            <i class="fas fa-sign-out-alt me-2"></i>Logout
                        </button>
                    </div>
                </div>

                <!-- Project List -->
                <div class="card">
                    <div class="card-header bg-light">
                        <i class="fas fa-globe me-2"></i>Website Saya
                    </div>
                    <div class="card-body p-0">
                        <ul class="list-group list-group-flush" id="projectList">
                            <!-- Projects loaded here -->
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="col-md-9">
                <!-- File Manager -->
                <div class="card mb-4 d-none" id="fileManager">
                    <div class="card-header bg-light d-flex justify-content-between align-items-center">
                        <div>
                            <i class="fas fa-folder text-warning me-2"></i>
                            <span id="currentProjectName" class="fw-bold"></span>
                            <small class="text-muted ms-2" id="currentProjectUrl"></small>
                        </div>
                        <div class="btn-group">
                            <button class="btn btn-sm btn-success" onclick="showAddFileModal()">
                                <i class="fas fa-plus"></i> File
                            </button>
                            <button class="btn btn-sm btn-outline-primary" onclick="showUploadModal()">
                                <i class="fas fa-upload"></i> Upload
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <nav aria-label="breadcrumb">
                            <ol class="breadcrumb" id="breadcrumb">
                                <li class="breadcrumb-item active">/</li>
                            </ol>
                        </nav>

                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead class="table-light">
                                    <tr>
                                        <th width="50px"></th>
                                        <th>Nama</th>
                                        <th>Ukuran</th>
                                        <th>Terakhir diubah</th>
                                        <th>Aksi</th>
                                    </tr>
                                </thead>
                                <tbody id="filesTable">
                                    <!-- Files loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Editor -->
                <div class="card d-none" id="editorSection">
                    <div class="card-header bg-light d-flex justify-content-between align-items-center">
                        <span id="editorFileName" class="fw-bold"></span>
                        <div>
                            <button class="btn btn-sm btn-success me-2" onclick="saveFile()">
                                <i class="fas fa-save me-1"></i> Simpan
                            </button>
                            <button class="btn btn-sm btn-secondary" onclick="closeEditor()">
                                <i class="fas fa-times me-1"></i> Tutup
                            </button>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        <div id="codeEditor" style="height: 500px;"></div>
                    </div>
                </div>

                <!-- Welcome Dashboard -->
                <div class="card" id="welcomeDashboard">
                    <div class="card-body text-center py-5">
                        <div class="mb-4">
                            <i class="fas fa-cloud-upload-alt fa-4x text-muted"></i>
                        </div>
                        <h3 class="mb-3">Selamat Datang di PGXL</h3>
                        <p class="text-muted mb-4">Pilih website dari sidebar atau buat website baru</p>
                        <div class="row text-start">
                            <div class="col-md-6 mb-2">
                                <i class="fas fa-check text-success me-2"></i> Upload file HTML, CSS, JS
                            </div>
                            <div class="col-md-6 mb-2">
                                <i class="fas fa-check text-success me-2"></i> Dapatkan subdomain gratis
                            </div>
                            <div class="col-md-6 mb-2">
                                <i class="fas fa-check text-success me-2"></i> Edit file langsung di browser
                            </div>
                            <div class="col-md-6 mb-2">
                                <i class="fas fa-check text-success me-2"></i> Auto deploy dalam hitungan detik
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="ads-footer">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <h5 class="mb-2">
                        <i class="fas fa-server me-2 text-primary"></i>PGXL.WEB.ID
                    </h5>
                    <p class="mb-0 text-muted">
                        Free static hosting platform for developers and creators.
                    </p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="mb-2">
                        <strong>üöÄ Powered by PGXL.WEB.ID</strong>
                    </p>
                    <p class="mb-0 text-muted">
                        ¬© 2025 PGXL.WEB.ID | 
                        <a href="#" class="text-decoration-none text-muted me-3">Terms</a>
                        <a href="#" class="text-decoration-none text-muted">Privacy</a>
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Modals -->
    <div class="modal fade" id="authModal" tabindex="-1">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header border-0">
                    <h5 class="modal-title">Login ke PGXL</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center">
                    <button class="btn btn-outline-dark w-100 mb-3" onclick="signInWithGoogle()">
                        <i class="fab fa-google me-2"></i> Google
                    </button>
                    <button class="btn btn-dark w-100" onclick="signInWithGithub()">
                        <i class="fab fa-github me-2"></i> GitHub
                    </button>
                    <hr class="my-4">
                    <p class="text-muted small">
                        Dengan login, kamu menyetujui Terms of Service kami.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Project Modal -->
    <div class="modal fade" id="addProjectModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">‚ûï Website Baru</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label fw-bold">Nama Project</label>
                        <input type="text" class="form-control" id="projectName" placeholder="my-portfolio">
                        <div class="form-text mt-2">
                            Domain kamu: <span class="project-domain" id="domainPreview">...</span>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold">Deskripsi (opsional)</label>
                        <textarea class="form-control" id="projectDescription" rows="2" placeholder="Website portfolio saya..."></textarea>
                    </div>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-primary" onclick="createProject()">Buat Website</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-storage-compat.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.js"></script>
    
    <script>
        // üî• FIREBASE CONFIG (Sesuaikan dengan project Firebase kamu)
        const firebaseConfig = {
            apiKey: "AIzaSyCjKsJ0FZv1U0h-zBOU_XN0xEYk1nVbp6E",
            authDomain: "pgxl-web-id.firebaseapp.com",
            projectId: "pgxl-web-id",
            storageBucket: "pgxl-web-id.appspot.com",
            messagingSenderId: "545920930826",
            appId: "1:545920930826:web:xxxxxxxxxxxxxxxx"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();

        // Google OAuth Provider
        const googleProvider = new firebase.auth.GoogleAuthProvider();
        googleProvider.setCustomParameters({
            client_id: '545920930826-tbk59eu6j9jh9dobt9v8km1bhcf13il6.apps.googleusercontent.com'
        });

        // GitHub OAuth Provider
        const githubProvider = new firebase.auth.GithubAuthProvider();
        githubProvider.addScope('repo');
        githubProvider.setCustomParameters({
            client_id: 'Ov23liWkUbRXsxsO63Sg'
        });

        // Global variables
        let currentUser = null;
        let currentProject = null;
        let currentPath = '/';
        let editor = null;

        // üî• DEFINE FUNCTIONS DI GLOBAL SCOPE
        window.showAuthModal = function() {
            new bootstrap.Modal(document.getElementById('authModal')).show();
        };

        window.signInWithGoogle = function() {
            auth.signInWithPopup(googleProvider)
                .then(() => {
                    bootstrap.Modal.getInstance(document.getElementById('authModal')).hide();
                })
                .catch(error => {
                    console.error('Google sign in error:', error);
                    alert('Login dengan Google gagal: ' + error.message);
                });
        };

        window.signInWithGithub = function() {
            auth.signInWithPopup(githubProvider)
                .then(() => {
                    bootstrap.Modal.getInstance(document.getElementById('authModal')).hide();
                })
                .catch(error => {
                    console.error('GitHub sign in error:', error);
                    alert('Login dengan GitHub gagal: ' + error.message);
                });
        };

        window.logout = function() {
            if (confirm('Yakin ingin logout?')) {
                auth.signOut();
            }
        };

        window.showAddProjectModal = function() {
            document.getElementById('projectName').value = '';
            document.getElementById('projectDescription').value = '';
            updateDomainPreview();
            new bootstrap.Modal(document.getElementById('addProjectModal')).show();
        };

        window.updateDomainPreview = function() {
            const name = document.getElementById('projectName').value.toLowerCase()
                .replace(/[^a-z0-9-]/g, '-')
                .replace(/-+/g, '-')
                .replace(/^-|-$/g, '') || 'myproject';
            document.getElementById('domainPreview').textContent = `${name}.pgxl.web.id`;
        };

        window.createProject = async function() {
            const name = document.getElementById('projectName').value;
            const description = document.getElementById('projectDescription').value;
            
            if (!name) {
                alert('Nama project harus diisi!');
                return;
            }

            const projectId = name.toLowerCase()
                .replace(/[^a-z0-9-]/g, '-')
                .replace(/-+/g, '-')
                .replace(/^-|-$/g, '');
            
            // Check if project already exists
            const existingProject = await db.collection('projects').doc(projectId).get();
            if (existingProject.exists) {
                alert('Nama project sudah digunakan. Coba nama lain.');
                return;
            }

            const projectData = {
                name: name,
                description: description,
                domain: `${projectId}.pgxl.web.id`,
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                owner: currentUser.uid,
                ownerEmail: currentUser.email,
                files: []
            };

            try {
                await db.collection('projects').doc(projectId).set(projectData);
                
                // Create default index.html
                const defaultHTML = `<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${name} - Hosted on PGXL</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .pgxl-ads { background: #f8f9fa; border: 2px solid #667eea; padding: 15px; text-align: center; margin: 30px 0; border-radius: 10px; }
    </style>
</head>
<body>
    <h1>Welcome to ${name}</h1>
    <p>Your website is hosted on PGXL.WEB.ID</p>
    
    <div class="pgxl-ads">
        <h3>üöÄ Powered by PGXL.WEB.ID</h3>
        <p>Free static hosting with custom subdomain</p>
        <a href="https://pgxl.web.id" target="_blank">Create your own free website</a>
    </div>
    
    <p>Edit this file in your dashboard to customize your website.</p>
</body>
</html>`;

                await storage.ref(`projects/${projectId}/index.html`).putString(defaultHTML, 'raw');
                
                bootstrap.Modal.getInstance(document.getElementById('addProjectModal')).hide();
                alert('Website berhasil dibuat!');
                loadProjects();
                openProject(projectId);
            } catch (error) {
                console.error('Error creating project:', error);
                alert('Gagal membuat website: ' + error.message);
            }
        };

        // Load projects function
        async function loadProjects() {
            try {
                const snapshot = await db.collection('projects')
                    .where('owner', '==', currentUser.uid)
                    .orderBy('createdAt', 'desc')
                    .get();
                
                const projectList = document.getElementById('projectList');
                projectList.innerHTML = '';
                
                snapshot.forEach(doc => {
                    const project = doc.data();
                    const li = document.createElement('li');
                    li.className = 'list-group-item list-group-item-action';
                    li.innerHTML = `
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <div class="fw-bold">${project.name}</div>
                                <small class="text-muted">${project.domain}</small>
                            </div>
                            <button class="btn btn-sm btn-outline-primary" onclick="openProject('${doc.id}')">
                                <i class="fas fa-folder-open"></i>
                            </button>
                        </div>
                    `;
                    projectList.appendChild(li);
                });
            } catch (error) {
                console.error('Error loading projects:', error);
            }
        }

        window.openProject = function(projectId) {
            currentProject = projectId;
            document.getElementById('welcomeDashboard').classList.add('d-none');
            document.getElementById('fileManager').classList.remove('d-none');
            document.getElementById('editorSection').classList.add('d-none');
            
            db.collection('projects').doc(projectId).get().then(doc => {
                const project = doc.data();
                document.getElementById('currentProjectName').textContent = project.name;
                document.getElementById('currentProjectUrl').innerHTML = 
                    ` ‚Üí <a href="https://${project.domain}" target="_blank" class="text-decoration-none">${project.domain} <i class="fas fa-external-link-alt fa-xs"></i></a>`;
            });
            
            loadFiles('/');
        };

        window.openFolder = function(folderName) {
            loadFiles(currentPath + folderName);
        };

        window.editFile = async function(fileName) {
            try {
                const fileRef = storage.ref(`projects/${currentProject}${currentPath}${fileName}`);
                const url = await fileRef.getDownloadURL();
                const response = await fetch(url);
                const content = await response.text();
                
                document.getElementById('fileManager').classList.add('d-none');
                document.getElementById('editorSection').classList.remove('d-none');
                document.getElementById('editorFileName').textContent = fileName;
                
                if (!editor) {
                    editor = ace.edit("codeEditor");
                    editor.setTheme("ace/theme/chrome");
                    editor.session.setMode("ace/mode/html");
                }
                
                editor.setValue(content, -1);
                editor.session.setMode(getEditorMode(fileName));
            } catch (error) {
                console.error('Error editing file:', error);
                alert('Gagal membuka file: ' + error.message);
            }
        };

        window.saveFile = async function() {
            const fileName = document.getElementById('editorFileName').textContent;
            const content = editor.getValue();
            
            try {
                const fileRef = storage.ref(`projects/${currentProject}${currentPath}${fileName}`);
                await fileRef.putString(content, 'raw');
                alert('‚úÖ File berhasil disimpan!');
                loadFiles(currentPath);
            } catch (error) {
                console.error('Error saving file:', error);
                alert('‚ùå Gagal menyimpan file: ' + error.message);
            }
        };

        window.closeEditor = function() {
            document.getElementById('editorSection').classList.add('d-none');
            document.getElementById('fileManager').classList.remove('d-none');
        };

        window.showAddFileModal = function() {
            const name = prompt('Nama file baru:');
            if (name) {
                const defaultContent = name.endsWith('.html') ? 
                    `<!DOCTYPE html><html><body><h1>New Page</h1></body></html>` : '';
                
                const fileRef = storage.ref(`projects/${currentProject}${currentPath}${name}`);
                fileRef.putString(defaultContent, 'raw').then(() => {
                    loadFiles(currentPath);
                });
            }
        };

        window.showUploadModal = function() {
            const input = document.createElement('input');
            input.type = 'file';
            input.multiple = true;
            input.onchange = async (e) => {
                const files = e.target.files;
                for (let file of files) {
                    const fileRef = storage.ref(`projects/${currentProject}${currentPath}${file.name}`);
                    await fileRef.put(file);
                }
                loadFiles(currentPath);
            };
            input.click();
        };

        window.deleteFile = async function(fileName) {
            if (confirm(`Hapus file "${fileName}"?`)) {
                try {
                    const fileRef = storage.ref(`projects/${currentProject}${currentPath}${fileName}`);
                    await fileRef.delete();
                    loadFiles(currentPath);
                    alert('‚úÖ File berhasil dihapus');
                } catch (error) {
                    console.error('Error deleting file:', error);
                    alert('‚ùå Gagal menghapus file');
                }
            }
        };

        // Helper functions
        async function loadFiles(path) {
            currentPath = path;
            
            const filesTable = document.getElementById('filesTable');
            filesTable.innerHTML = '<tr><td colspan="5" class="text-center">Loading...</td></tr>';
            
            try {
                const listRef = storage.ref(`projects/${currentProject}${path}`);
                const result = await listRef.listAll();
                
                filesTable.innerHTML = '';
                
                result.prefixes.forEach(folderRef => {
                    const name = folderRef.name;
                    const tr = document.createElement('tr');
                    tr.className = 'file-item';
                    tr.innerHTML = `
                        <td><i class="fas fa-folder text-warning"></i></td>
                        <td><strong>${name}</strong></td>
                        <td>-</td>
                        <td>-</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary" onclick="openFolder('${name}/')">
                                Buka
                            </button>
                        </td>
                    `;
                    filesTable.appendChild(tr);
                });
                
                for (const itemRef of result.items) {
                    const metadata = await itemRef.getMetadata();
                    const name = itemRef.name;
                    const size = formatBytes(metadata.size);
                    const updated = new Date(metadata.updated).toLocaleString();
                    
                    const tr = document.createElement('tr');
                    tr.className = 'file-item';
                    tr.innerHTML = `
                        <td><i class="fas fa-file text-primary"></i></td>
                        <td>${name}</td>
                        <td>${size}</td>
                        <td>${updated}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-success me-1" onclick="editFile('${name}')">
                                Edit
                            </button>
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteFile('${name}')">
                                Hapus
                            </button>
                        </td>
                    `;
                    filesTable.appendChild(tr);
                }
            } catch (error) {
                console.error('Error loading files:', error);
                filesTable.innerHTML = '<tr><td colspan="5" class="text-center text-danger">Error loading files</td></tr>';
            }
        }

        function getEditorMode(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            const modes = {
                'html': 'ace/mode/html',
                'css': 'ace/mode/css',
                'js': 'ace/mode/javascript',
                'json': 'ace/mode/json',
                'txt': 'ace/mode/text'
            };
            return modes[ext] || 'ace/mode/text';
        }

        function formatBytes(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // DOM Ready
        document.addEventListener('DOMContentLoaded', function() {
            // Auth State Listener
            auth.onAuthStateChanged((user) => {
                if (user) {
                    currentUser = user;
                    showDashboard();
                } else {
                    showWelcome();
                }
            });

            // Init domain preview
            document.getElementById('projectName').addEventListener('input', updateDomainPreview);
        });

        function showWelcome() {
            document.getElementById('welcomeSection').classList.remove('d-none');
            document.getElementById('dashboard').classList.add('d-none');
            document.getElementById('authButtons').innerHTML = `
                <button class="btn btn-outline-primary" onclick="showAuthModal()">
                    <i class="fas fa-sign-in-alt me-1"></i> Login
                </button>
            `;
        }

        function showDashboard() {
            document.getElementById('welcomeSection').classList.add('d-none');
            document.getElementById('dashboard').classList.remove('d-none');
            document.getElementById('userEmail').textContent = currentUser.email;
            document.getElementById('authButtons').innerHTML = `
                <div class="d-flex align-items-center">
                    <span class="me-3 text-muted">${currentUser.email}</span>
                    <button class="btn btn-outline-danger btn-sm" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            `;
            loadProjects();
        }
    }); // ‚Üê TAMBAHKAN INI
}); // ‚Üê DAN INI

        function showAuthModal() {
            new bootstrap.Modal(document.getElementById('authModal')).show();
        }

        function showAddProjectModal() {
            document.getElementById('projectName').value = '';
            document.getElementById('projectDescription').value = '';
            updateDomainPreview();
            new bootstrap.Modal(document.getElementById('addProjectModal')).show();
        }

        function updateDomainPreview() {
            const name = document.getElementById('projectName').value.toLowerCase()
                .replace(/[^a-z0-9-]/g, '-')
                .replace(/-+/g, '-')
                .replace(/^-|-$/g, '') || 'myproject';
            document.getElementById('domainPreview').textContent = `${name}.pgxl.web.id`;
        }

        async function createProject() {
            const name = document.getElementById('projectName').value;
            const description = document.getElementById('projectDescription').value;
            
            if (!name) {
                alert('Nama project harus diisi!');
                return;
            }

            const projectId = name.toLowerCase()
                .replace(/[^a-z0-9-]/g, '-')
                .replace(/-+/g, '-')
                .replace(/^-|-$/g, '');
            
            // Check if project already exists
            const existingProject = await db.collection('projects').doc(projectId).get();
            if (existingProject.exists) {
                alert('Nama project sudah digunakan. Coba nama lain.');
                return;
            }

            const projectData = {
                name: name,
                description: description,
                domain: `${projectId}.pgxl.web.id`,
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                owner: currentUser.uid,
                ownerEmail: currentUser.email,
                files: []
            };

            try {
                await db.collection('projects').doc(projectId).set(projectData);
                
                // Create default index.html with PGXL ads
                const defaultHTML = `<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${name} - Hosted on PGXL</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f8fafc;
        }
        .container {
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            margin: 20px 0;
        }
        h1 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 2.5em;
        }
        p {
            margin-bottom: 15px;
            color: #64748b;
        }
        .pgxl-ads {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            margin: 40px 0;
            text-align: center;
        }
        .pgxl-ads h3 {
            margin-bottom: 10px;
            font-size: 1.5em;
        }
        .pgxl-ads a {
            color: white;
            text-decoration: none;
            background: rgba(255,255,255,0.2);
            padding: 10px 20px;
            border-radius: 50px;
            display: inline-block;
            margin-top: 15px;
            transition: background 0.3s;
        }
        .pgxl-ads a:hover {
            background: rgba(255,255,255,0.3);
        }
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        .feature {
            background: #f1f5f9;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        .feature i {
            font-size: 2em;
            color: #667eea;
            margin-bottom: 10px;
        }
        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
        }
        .logo i {
            font-size: 2em;
            color: #667eea;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">
            <i class="fas fa-server"></i>
            <h2>${name}</h2>
        </div>
        
        <h1>Selamat! Website Anda Sudah Online üéâ</h1>
        
        <p>Website ini dihosting secara gratis di <strong>PGXL.WEB.ID</strong>. Anda dapat mengedit konten ini melalui dashboard PGXL.</p>
        
        <div class="features">
            <div class="feature">
                <i class="fas fa-bolt"></i>
                <h4>Deploy Instan</h4>
                <p>Upload file, langsung online</p>
            </div>
            <div class="feature">
                <i class="fas fa-code"></i>
                <h4>File Manager</h4>
                <p>Edit langsung di browser</p>
            </div>
            <div class="feature">
                <i class="fas fa-shield-alt"></i>
                <h4>Gratis 100%</h4>
                <p>Tidak ada biaya tersembunyi</p>
            </div>
        </div>
        
        <p>Untuk mulai mengedit, login ke <a href="https://pgxl.web.id">PGXL.WEB.ID</a> dan pilih project "${name}".</p>
        
        <div class="pgxl-ads">
            <h3>üöÄ Powered by PGXL.WEB.ID</h3>
            <p>Free static hosting dengan subdomain custom</p>
            <a href="https://pgxl.web.id" target="_blank">Buat Website Gratis Anda</a>
        </div>
        
        <p><small>Domain: ${projectId}.pgxl.web.id</small></p>
    </div>
</body>
</html>`;

                // Upload default files
                await storage.ref(`projects/${projectId}/index.html`).putString(defaultHTML, 'raw');
                
                // Create default CSS
                const defaultCSS = `/* Style untuk website ${name} */
body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    line-height: 1.6;
    color: #333;
}

.container {
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
}

h1, h2, h3 {
    color: #667eea;
}

.pgxl-ads {
    background: #f8f9fa;
    border: 2px solid #667eea;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    margin: 30px 0;
}`;

                await storage.ref(`projects/${projectId}/style.css`).putString(defaultCSS, 'raw');
                
                bootstrap.Modal.getInstance(document.getElementById('addProjectModal')).hide();
                alert('Website berhasil dibuat!');
                loadProjects();
                openProject(projectId);
            } catch (error) {
                console.error('Error creating project:', error);
                alert('Gagal membuat website: ' + error.message);
            }
        }

        async function loadProjects() {
            try {
                const snapshot = await db.collection('projects')
                    .where('owner', '==', currentUser.uid)
                    .orderBy('createdAt', 'desc')
                    .get();
                
                const projectList = document.getElementById('projectList');
                projectList.innerHTML = '';
                
                snapshot.forEach(doc => {
                    const project = doc.data();
                    const li = document.createElement('li');
                    li.className = 'list-group-item list-group-item-action';
                    li.innerHTML = `
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <div class="fw-bold">${project.name}</div>
                                <small class="text-muted">${project.domain}</small>
                            </div>
                            <button class="btn btn-sm btn-outline-primary" onclick="openProject('${doc.id}')">
                                <i class="fas fa-folder-open"></i>
                            </button>
                        </div>
                    `;
                    projectList.appendChild(li);
                });
                
                if (snapshot.empty) {
                    projectList.innerHTML = `
                        <li class="list-group-item text-center text-muted py-4">
                            <i class="fas fa-folder-open fa-2x mb-3"></i>
                            <p>Belum ada website</p>
                            <button class="btn btn-sm btn-primary" onclick="showAddProjectModal()">
                                Buat Website Pertama
                            </button>
                        </li>
                    `;
                }
            } catch (error) {
                console.error('Error loading projects:', error);
                document.getElementById('projectList').innerHTML = `
                    <li class="list-group-item text-center text-danger py-4">
                        Error loading projects
                    </li>
                `;
            }
        }

        function openProject(projectId) {
            currentProject = projectId;
            document.getElementById('welcomeDashboard').classList.add('d-none');
            document.getElementById('fileManager').classList.remove('d-none');
            document.getElementById('editorSection').classList.add('d-none');
            
            db.collection('projects').doc(projectId).get().then(doc => {
                const project = doc.data();
                document.getElementById('currentProjectName').textContent = project.name;
                document.getElementById('currentProjectUrl').innerHTML = 
                    ` ‚Üí <a href="https://${project.domain}" target="_blank" class="text-decoration-none">${project.domain} <i class="fas fa-external-link-alt fa-xs"></i></a>`;
            });
            
            loadFiles('/');
        }

        async function loadFiles(path) {
            currentPath = path;
            
            // Update breadcrumb
            const breadcrumb = document.getElementById('breadcrumb');
            const parts = path.split('/').filter(p => p);
            breadcrumb.innerHTML = '<li class="breadcrumb-item active">/</li>';
            
            let currentBreadcrumbPath = '';
            parts.forEach(part => {
                currentBreadcrumbPath += part + '/';
                const li = document.createElement('li');
                li.className = 'breadcrumb-item';
                li.innerHTML = `<a href="#" onclick="loadFiles('${currentBreadcrumbPath}')">${part}</a>`;
                breadcrumb.appendChild(li);
            });
            
            const filesTable = document.getElementById('filesTable');
            filesTable.innerHTML = '<tr><td colspan="5" class="text-center py-4"><div class="spinner-border spinner-border-sm"></div> Loading...</td></tr>';
            
            try {
                const listRef = storage.ref(`projects/${currentProject}${path}`);
                const result = await listRef.listAll();
                
                filesTable.innerHTML = '';
                
                // Directories first
                result.prefixes.forEach(folderRef => {
                    const name = folderRef.name;
                    const tr = document.createElement('tr');
                    tr.className = 'file-item';
                    tr.innerHTML = `
                        <td><i class="fas fa-folder text-warning"></i></td>
                        <td><strong>${name}</strong></td>
                        <td>-</td>
                        <td>-</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary" onclick="openFolder('${name}/')">
                                Buka
                            </button>
                        </td>
                    `;
                    filesTable.appendChild(tr);
                });
                
                // Files
                for (const itemRef of result.items) {
                    const metadata = await itemRef.getMetadata();
                    const name = itemRef.name;
                    const size = formatBytes(metadata.size);
                    const updated = new Date(metadata.updated).toLocaleDateString('id-ID', {
                        day: 'numeric',
                        month: 'short',
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    const tr = document.createElement('tr');
                    tr.className = 'file-item';
                    tr.innerHTML = `
                        <td><i class="fas fa-file text-primary"></i></td>
                        <td>${name}</td>
                        <td>${size}</td>
                        <td>${updated}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-success me-1" onclick="editFile('${name}')">
                                Edit
                            </button>
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteFile('${name}')">
                                Hapus
                            </button>
                        </td>
                    `;
                    filesTable.appendChild(tr);
                }
                
                if (result.prefixes.length === 0 && result.items.length === 0) {
                    filesTable.innerHTML = `
                        <tr>
                            <td colspan="5" class="text-center py-4 text-muted">
                                <i class="fas fa-folder-open fa-2x mb-3 d-block"></i>
                                Folder kosong
                            </td>
                        </tr>
                    `;
                }
            } catch (error) {
                console.error('Error loading files:', error);
                filesTable.innerHTML = `
                    <tr>
                        <td colspan="5" class="text-center py-4 text-danger">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            Error loading files
                        </td>
                    </tr>
                `;
            }
        }

        function openFolder(folderName) {
            loadFiles(currentPath + folderName);
        }

        async function editFile(fileName) {
            try {
                const fileRef = storage.ref(`projects/${currentProject}${currentPath}${fileName}`);
                const url = await fileRef.getDownloadURL();
                const response = await fetch(url);
                const content = await response.text();
                
                document.getElementById('fileManager').classList.add('d-none');
                document.getElementById('editorSection').classList.remove('d-none');
                document.getElementById('editorFileName').textContent = fileName;
                
                if (!editor) {
                    editor = ace.edit("codeEditor");
                    editor.setTheme("ace/theme/chrome");
                    editor.session.setMode("ace/mode/html");
                    editor.setOptions({
                        fontSize: "14px",
                        showPrintMargin: false,
                        wrap: true,
                        enableBasicAutocompletion: true,
                        enableLiveAutocompletion: true
                    });
                }
                
                editor.setValue(content, -1);
                editor.session.setMode(getEditorMode(fileName));
                editor.focus();
            } catch (error) {
                console.error('Error editing file:', error);
                alert('Gagal membuka file: ' + error.message);
            }
        }

        function getEditorMode(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            const modes = {
                'html': 'ace/mode/html',
                'htm': 'ace/mode/html',
                'css': 'ace/mode/css',
                'js': 'ace/mode/javascript',
                'json': 'ace/mode/json',
                'txt': 'ace/mode/text',
                'md': 'ace/mode/markdown',
                'php': 'ace/mode/php',
                'py': 'ace/mode/python',
                'java': 'ace/mode/java'
            };
            return modes[ext] || 'ace/mode/text';
        }

        async function saveFile() {
            const fileName = document.getElementById('editorFileName').textContent;
            const content = editor.getValue();
            
            try {
                const fileRef = storage.ref(`projects/${currentProject}${currentPath}${fileName}`);
                await fileRef.putString(content, 'raw');
                
                // Update project's files list
                await db.collection('projects').doc(currentProject).update({
                    [`files.${currentPath}${fileName}`]: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                alert('‚úÖ File berhasil disimpan!');
                loadFiles(currentPath);
            } catch (error) {
                console.error('Error saving file:', error);
                alert('‚ùå Gagal menyimpan file: ' + error.message);
            }
        }

        function closeEditor() {
            if (editor.getValue() !== editor.originalValue) {
                if (confirm('Anda memiliki perubahan yang belum disimpan. Tutup tanpa menyimpan?')) {
                    document.getElementById('editorSection').classList.add('d-none');
                    document.getElementById('fileManager').classList.remove('d-none');
                }
            } else {
                document.getElementById('editorSection').classList.add('d-none');
                document.getElementById('fileManager').classList.remove('d-none');
            }
        }

        function showAddFileModal() {
            const name = prompt('Nama file baru (contoh: style.css, script.js, about.html):');
            if (name) {
                const defaultContent = getDefaultFileContent(name);
                const fileRef = storage.ref(`projects/${currentProject}${currentPath}${name}`);
                fileRef.putString(defaultContent, 'raw').then(() => {
                    loadFiles(currentPath);
                    alert('File berhasil dibuat: ' + name);
                }).catch(error => {
                    alert('Gagal membuat file: ' + error.message);
                });
            }
        }

        function getDefaultFileContent(filename) {
            if (filename.endsWith('.html')) {
                return `<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Halaman Baru</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>Selamat Datang</h1>
        <p>Halaman ini dibuat dengan PGXL.WEB.ID</p>
        
        <div class="pgxl-ads">
            <p>üöÄ <strong>Hosted on PGXL.WEB.ID</strong></p>
            <p>Free static hosting with custom subdomain</p>
            <a href="https://pgxl.web.id">Create your own free website</a>
        </div>
    </div>
    
    <script src="script.js"></script>
</body>
</html>`;
            } else if (filename.endsWith('.css')) {
                return `/* Style untuk ${filename} */

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    line-height: 1.6;
    margin: 0;
    padding: 20px;
    background: #f8fafc;
    color: #333;
}

.container {
    max-width: 800px;
    margin: 0 auto;
    background: white;
    padding: 30px;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.05);
}

h1 {
    color: #667eea;
    margin-bottom: 20px;
}

.pgxl-ads {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 20px;
    border-radius: 10px;
    margin: 30px 0;
    text-align: center;
}

.pgxl-ads a {
    color: white;
    text-decoration: none;
    background: rgba(255,255,255,0.2);
    padding: 8px 16px;
    border-radius: 50px;
    display: inline-block;
    margin-top: 10px;
}`;
            } else if (filename.endsWith('.js')) {
                return `// ${filename}
// JavaScript untuk website Anda

console.log('Website hosted on PGXL.WEB.ID');

// Contoh fungsi
function showWelcome() {
    alert('Selamat datang di website yang dihosting di PGXL!');
}

// Auto execute
document.addEventListener('DOMContentLoaded', function() {
    console.log('Document loaded');
    
    // Tambahkan footer credits
    const footer = document.createElement('div');
    footer.innerHTML = \`
        <div style="text-align:center; margin-top:40px; padding:20px; background:#f8f9fa; border-radius:10px;">
            <p>üöÄ <strong>Hosted on <a href="https://pgxl.web.id">PGXL.WEB.ID</a></strong></p>
            <p>Free static hosting platform</p>
        </div>
    \`;
    document.body.appendChild(footer);
});`;
            } else {
                return `File: ${filename}
Dibuat dengan PGXL.WEB.ID - Free static hosting platform`;
            }
        }

        function showUploadModal() {
            const input = document.createElement('input');
            input.type = 'file';
            input.multiple = true;
            input.onchange = async (e) => {
                const files = e.target.files;
                let uploaded = 0;
                
                for (let file of files) {
                    const fileRef = storage.ref(`projects/${currentProject}${currentPath}${file.name}`);
                    try {
                        await fileRef.put(file);
                        uploaded++;
                    } catch (error) {
                        console.error('Error uploading:', error);
                    }
                }
                
                loadFiles(currentPath);
                alert(`‚úÖ ${uploaded} dari ${files.length} file berhasil diupload`);
            };
            input.click();
        }

        async function deleteFile(fileName) {
            if (confirm(`Yakin hapus file "${fileName}"?`)) {
                try {
                    const fileRef = storage.ref(`projects/${currentProject}${currentPath}${fileName}`);
                    await fileRef.delete();
                    
                    // Update project's files list
                    await db.collection('projects').doc(currentProject).update({
                        [`files.${currentPath}${fileName}`]: firebase.firestore.FieldValue.delete()
                    });
                    
                    loadFiles(currentPath);
                    alert('‚úÖ File berhasil dihapus');
                } catch (error) {
                    console.error('Error deleting file:', error);
                    alert('‚ùå Gagal menghapus file');
                }
            }
        }

        function formatBytes(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // üîê AUTH FUNCTIONS
        function signInWithGoogle() {
            auth.signInWithPopup(googleProvider)
                .then(() => {
                    bootstrap.Modal.getInstance(document.getElementById('authModal')).hide();
                })
                .catch(error => {
                    console.error('Google sign in error:', error);
                    alert('Login dengan Google gagal: ' + error.message);
                });
        }

        function signInWithGithub() {
            auth.signInWithPopup(githubProvider)
                .then(() => {
                    bootstrap.Modal.getInstance(document.getElementById('authModal')).hide();
                })
                .catch(error => {
                    console.error('GitHub sign in error:', error);
                    alert('Login dengan GitHub gagal: ' + error.message);
                });
        }

        function logout() {
            if (confirm('Yakin ingin logout?')) {
                auth.signOut();
            }
        }

        // Set original value for editor
        ace.require("ace/ext/whitespace");
    </script>
</body>
</html>
